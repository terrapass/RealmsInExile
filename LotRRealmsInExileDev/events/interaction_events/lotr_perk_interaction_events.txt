
### Events fired by Perk Interactions
namespace = perk_interaction

##################################################
# Song Battles
# by Brice Underhill
# 0200 - 0299
##################################################

#	Follow-up event.
perk_interaction.0200 = {
	hidden = yes

	immediate = {
		# We don't bother with a delay here because there's no risk of death, and we want to transfer counties and such immediately.
		# Send out a toast to the victor.
		if = {
			limit = {
				or ={
					scope:sb_victor = { faith_is_evil = yes}
					scope:sb_loser = { faith_is_evil = yes}
				}
			}
			scope:sb_victor = { 
				add_character_modifier = {
					modifier = magical_supremacy_modifier
					days = 10
				}
			}
			configure_start_single_combat_effect = {
			SC_INITIATOR = sb_victor
			SC_ATTACKER = sb_victor
			SC_DEFENDER = sb_loser
			FATALITY = no
			FIXED = no
			LOCALE = terrain_scope
			OUTPUT_EVENT = perk_interaction.0201
			INVALIDATION_EVENT = fp1_tbc.0102
		}
	}
}



perk_interaction.0201 = {
	hidden = yes

	immediate = {
		scope:sc_victor = { save_scope_as = sb_victor }
		scope:sc_loser = { save_scope_as = sb_loser }
		# We don't bother with a delay here because there's no risk of death, and we want to transfer counties and such immediately.
		# Send out a toast to the victor.
		scope:sb_victor = {
			send_interface_toast = {
				title = perk_interaction.0201.victor_toast.t
				left_icon = scope:sb_victor
				right_icon = scope:sb_loser
				show_as_tooltip = { perk_interaction_0201_apply_effects_effect = yes }
			}
		}
		# And to the loser.
		scope:sb_loser = {
			send_interface_toast = {
				title = perk_interaction.0201.loser_toast.t
				left_icon = scope:sb_loser
				right_icon = scope:sb_victor
				show_as_tooltip = { perk_interaction_0201_apply_effects_effect = yes }
			}
		}
		# Then execute the actual effects.
		perk_interaction_0201_apply_effects_effect = yes
	}
}
