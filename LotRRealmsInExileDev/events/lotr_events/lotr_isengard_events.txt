namespace = isengard

#### INDEX ####
### Maintenance: 0000-0099
### General: 0100-0199
## Introduction
# 0101 - The Lord of Isengard
# 0102 - My Search for the One
# 0103 - The Palantír
### Align with Sauron: 0200-0299
## General Align Events
# 0201 - An Army Worthy of Mordor
# 0202 - Wildmen of the West
# 0203 - A New Breed of Uruk
## Dunlendings
# 0210 - The Petty Kings of Dunland
# 0211 - An Emissary from the White Wizard
# 0212 - Wulf Bends the Knee
# 0213 - The Defiant Wildman
# 0214 - Dunland United
# 0215 - Dunland Conquered
## Uruk Hai
# 0220 - The Infantry of the Uruk-hai
# 0221 - The Archers of the Uruk-hai
# 0222 - My Army's Secret Weapon
# 0223 - The Most Loyal of Uruks
## Dealing with Rohan
# 0230 - The Question of the Riddermark
# 0231 - An Ultimatum from Isengard
# 0232 - The Submission of Rohan
# 0233 - The Folly of Rohan
# 0240 - An Agent in Edoras
# 0241 - Corruption of Theoden
# 0242 - The Ailing of the King
# 0243 - The White Wizard Arrives
# 0250 - Organise Raids on the Westfold
# 0251 - Reports of Raiders
# 0252 - Pillaging of the Westfold
# 0253 - The Fall of Theodred
# 0254 - The Treachery of Isengard
# 0255 - Signs of Treachery
# 0256 - A Worm Exposed
# 0257 - The Rot of the Riddermark
# 0258 - The Worm Submits
# 0259 - Developments in Rohan
# 0260 - Seeking Alliances
# 0270 - The Execution of Theodred
### Resist Sauron: 0300-0399
## General Resist Events
# 0301 - The Fate of the Palantír
# 0302 - A New Way Forward
## The White Council
# 0310 - Summon the White Council
# 0311 - The Wisdom of Gandalf
# 0312 - The Counsel of Elrond
# 0313 - The Intellect of Galadriel
# 0313 - The Intuition of Radagast - Pre-emptive strike on Dol Guldur?
# 0314 - The Wisdom of Alatar
# 0315 - The Vision of Pallando
# 0316 - The Alliance of the Wise
## Swear Fealty to Gondor
# 0320 - An Advisor to Gondor
# 0321 - MATT STUFF
## Swear Fealty to Rohan
# 0330 - An Advisor to Rohan
# 0331 - Rapproachment with Dunland
## Remain Independent
# 0350 - Warden of the West

isengard.0101 = { # The Lord of Isengard
	type = character_event
	title = isengard.0101.t
	desc = isengard.0101.desc
	theme = stewardship_domain_focus
	left_portrait = {
		character = root
		animation = personality_bold
	}
	lower_left_portrait = scope:beren
	lower_right_portrait = scope:helm
	right_portrait = {
		character = scope:frealaf
		animation = personality_content
	}

	immediate = {
		character:linesteward31 = { save_scope_as = beren }
		character:linesteward38 = { save_scope_as = denethor }
		character:6000010 = { save_scope_as = frealaf }
		character:6000008 = { save_scope_as = helm }
		character:lineoffreca3 = { save_scope_as = wulf }
		title:c_isengard = { save_scope_as = title_c_isengard }
	}

	option = { # And so have I remained for the last 240 years...
		name = isengard.0101.a
		trigger_event = {
			id = isengard.0102
			days = 5
		}
	}
}

isengard.0102 = { # My Search for the One
	type = character_event
	title = isengard.0102.t
	desc = isengard.0102.desc
	theme = stewardship_domain_focus
	left_portrait = {
		character = root
		animation = personality_rational
	}

	immediate = {
		character:lineofsauron = { save_scope_as = sauron }
	}

	option = { # I must find the One Ring and bring order to Middle-earth!
		name = isengard.0102.a
		character:lineofsaruman = {
			create_artifact_palantir_orthanc_effect = { OWNER = this }
		}
		custom_tooltip = isengard.0102.a.tt
		# root.culture = { add_innovation = innovation_numenorean_architecture_01 } #Why?
		add_character_flag = saruman_palantir_introduction
		trigger_event = {
			id = isengard.0103
			days = 5
		}
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 75
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
	option = { # This stone has corrupted my heart for long enough...
		name = isengard.0102.b
		custom_tooltip = isengard.0102.b.tt
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 0
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 25
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	# 	add_prestige = medium_prestige_loss
	# 	add_piety = minor_piety_gain
	# 	create_title_and_vassal_change = {
	# 		type = swear_fealty
	# 		save_scope_as = title_change
	# 		add_claim_on_loss = no
	# 	}
	# 	change_liege = {
	# 		liege = scope:denethor
	# 		change = scope:title_change
	# 	}
	# 	root = { save_scope_as = recipient }
	# 	scope:denethor = { save_scope_as = actor }
	# 	scope:actor = { trigger_event = char_interaction.0101 }
	# 	resolve_title_and_vassal_change = scope:title_change
	# 	hidden_effect = { # A most advantagous vassalship.
	# 		set_vassal_contract_modification_blocked = yes
	# 		vassal_contract_set_obligation_level = { type = feudal_government_taxes level = 0 }
	# 		vassal_contract_set_obligation_level = { type = feudal_government_levies level = 0 }
	# 		vassal_contract_set_obligation_level = { type = religious_rights level = 1 }
	# 		vassal_contract_set_obligation_level = { type = council_rights level = 1 }
	# #		vassal_contract_set_obligation_level = { type = war_declaration_rights level = 1 }
	# 		vassal_contract_set_obligation_level = { type = title_revocation_rights level = 1 }
	# 	}
	# 	# A Wizard in the Hall of Kings.
	# 	trigger_event = {
	# 		id = saruman.0005
	# 		days = { 900 3300 }
	# 	}
	# 	# Consolidation of Dunland.
	# 	trigger_event = {
	# 		id = saruman.0007
	# 		days = { 900 3300 }
	# 	}
	# 	ai_chance = { base = 0 }
	}
}

isengard.0103 = { # The Palantír
	type = character_event
	title = isengard.0103.t
	desc = isengard.0103.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:sauron
		animation = anger
	}
	artifact = {
		target = scope:palantir_orthanc
		position = lower_center_portrait
		trigger = { exists = scope:palantir_orthanc }
	}
	
	immediate = {
		play_music_cue = "lotr_action_evil_01"
		random_character_artifact = {
			limit = { has_variable = palantir_orthanc }
			save_scope_as = palantir_orthanc
		}
	}

	option = { # Saruman pledges allegiance to you, Lord Sauron.
		name = isengard.0103.a
		custom_tooltip = isengard.0103.a.tt
		set_culture = culture:istari_evil
		set_character_faith = faith:lidless_eye
		capital_county = { set_county_faith = faith:lidless_eye }
		add_character_flag = saruman_accepted_sauron
		add_stress = medium_stress_impact_gain
		scope:sauron = {
			add_opinion = {
				modifier = pleased_opinion
				target = root
				opinion = 40
			}
		}
		trigger_event = { # Build me an army worth of Mordor
			id = isengard.0201
			days = 1 # 365
		}
		# trigger_event = { # Cult of the White Hand.
		# 	id = saruman.0006
		# 	days = { 900 2100 }
		# }
		# Thrydan of the Wildmen of Dunland.
		#	Isengarder rebellion.
		#	Thrydan gathers armies.
		# Wulfgar Brynjarsson of the Frecalings.
		#	Wulfgar gathers armies.
		#	Wulfdene Wulfdening of the Frecalings.
		#		Wulfdene gathers armies.
		#	The tribe of Morcad.
		#	The tribe of Galtrev.
		#	The tribe of Starkmoors.
		#	The tribe of Carreglyn (Bog Barrows).
		#	West Marches.
		#	Dunlending rejection.
		#		Burning of Dunland (Ravndal, Nen Gwathlo).
		ai_chance = {
			base = 100
		}
	}
	option = { # You shall not have the Orthanc Stone, Dark Lord.
		name = isengard.0103.b
		custom_tooltip = isengard.0103.b.tt
		add_dread = 26
		add_stress = 285
		#Add permanent modifier stress gain
		add_character_flag = saruman_rejected_sauron
		ai_chance = {
			base = 0
		}
	}
}

isengard.0201 = { # The First Command of Sauron
	type = character_event
	title = isengard.0201.t
	desc = isengard.0201.desc
	theme = martial
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:sauron
		animation = anger
	}
	lower_right_portrait = scope:grishnakh

	immediate = {
		character:lineofsauron = { save_scope_as = sauron }
		create_character = {
			name = Grishn_akh
			gender = male
			age = 49
			culture = culture:ungurhai
			faith = faith:lidless_eye	
			trait = impatient
			trait = gluttonous
			trait = deceitful
			trait = education_martial_2
			trait = military_engineer
			save_scope_as = grishnakh
		}
	}

	option = { # We have work to do.
		name = isengard.0201.a
		custom_tooltip = isengard.0201.a.tt
		scope:grishnakh = {
			set_employer = root
		}
		spawn_army = {
			uses_supply = no
			inheritable = no
			name = isengard_orc_event_troops
			men_at_arms = {
				type = orc_warriors
				stacks = 1
			}
			men_at_arms = {
				type = orc_archers
				stacks = 1
			}
			men_at_arms = {
				type = mountainorc_warriors
				stacks = 1
			}
			location = capital_province
		}
		add_character_flag = saruman_build_me_an_army
	}
}

isengard.0210 = { # The Petty Kings of Dunland
	type = character_event
	title = isengard.0210.t
	desc = isengard.0210.desc
	theme = diplomacy
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_left_portrait = scope:dunlandfellsruler
	lower_right_portrait = scope:dathabharuler
	lower_center_portrait = scope:thirdruler
	right_portrait = {
		character = scope:warmonger
		animation = anger
	}

	immediate = {
		if = {
			limit = {
				exists = title:d_dunlandfells.holder
				NOT = {
					title:d_dunlandfells.holder = root
				}
			}
			title:d_dunlandfells.holder = { save_scope_as = dunlandfellsruler }
		}
		if = {
			limit = {
				exists = title:d_dathabha.holder
				NOR = {
					title:d_dathabha.holder = title:d_dunlandfells.holder
					title:d_dathabha.holder = root
				}
			}
			title:d_dathabha.holder = { save_scope_as = dathabharuler }
		}
		if = {
			limit = {
				exists = title:d_dunlending_wilds.holder
				NOR = {
					title:d_dunlending_wilds.holder = title:d_dunlandfells.holder
					title:d_dunlending_wilds.holder = title:d_dathabha.holder
					title:d_dunlending_wilds.holder = root
				}
			}
			title:d_dunlending_wilds.holder = { save_scope_as = thirdruler }
		}
		else_if = {
			limit = {
				exists = title:d_dunfearn.holder
				NOR = {
					title:d_dunfearn.holder = title:d_dunlandfells.holder
					title:d_dunfearn.holder = title:d_dathabha.holder
					title:d_dunfearn.holder = root
				}
			}
			title:d_dunfearn.holder = { save_scope_as = thirdruler }
		}
		if = {
			limit = {
				any_courtier = {
					limit = { is_orc = yes }
				}
			}
			random_courtier = {
				limit = { is_orc = yes }
				save_scope_as = warmonger
			}
		}
		else = {
			random_courtier = {
				save_scope_as = warmonger
			}
		}
		character:6000010 = { save_scope_as = frealaf }
		character:lineoffreca3 = { save_scope_as = wulf }
		save_scope_as = saruman
	}

	option = { # Send Emissary to potential ruler of Dunlandfells
		name = isengard.0210.a
		trigger = { exists = scope:dunlandfellsruler }
		if = {
			limit = { scope:dunlandfellsruler.dynasty = dynasty:dynasty_freca }
			custom_tooltip = isengard.0210.a.tt
			custom_tooltip = isengard.0210.a.tt2
		}
		else = { custom_tooltip = isengard.0210.a.tt.alt }
		scope:dunlandfellsruler = {
			trigger_event = {
				id = isengard.0211
				days = 1
			}
		}
	}

	option = { # Send Emissary to potential ruler of Dathabha
		name = isengard.0210.b
		trigger = { exists = scope:dathabharuler }
		if = {
			limit = { scope:dathabharuler = { has_trait = education_intrigue }  }
			custom_tooltip = isengard.0210.b.tt
			custom_tooltip = isengard.0210.b.tt2
		}
		else = { custom_tooltip = isengard.0210.b.tt.alt }
		scope:dathabharuler = {
			trigger_event = {
				id = isengard.0211
				days = 1
			}
		}
	}

	option = { # Send Emissary to potential third ruler
		name = isengard.0210.c
		trigger = { exists = scope:thirdruler }
		custom_tooltip = isengard.0210.c.tt
		scope:thirdruler = {
			trigger_event = {
				id = isengard.0211
				days = 1
			}
		}
	}

	option = { # These backward men have nothing to offer us.
		name = isengard.0210.d
		custom_tooltip = isengard.0210.d.tt
		hidden_effect = {
			if = {
				limit ={ 
					exists = scope:dunlandfellsruler
					exists = scope:dathabharuler
					scope:dunlandfellsruler = {
						NOT = { any_war_enemy = { this = scope:dathabharuler } }
					}
				}
				scope:dunlandfellsruler = { 
					create_alliance = scope:dathabharuler
					scope:dathabharuler = {
						add_opinion = {
							target = scope:dunlandfellsruler
							modifier = perk_negotiated_alliance_opinion
						}
					}
				}
			}
			if = {
				limit ={ 
					exists = scope:dunlandfellsruler
					exists = scope:thirdruler
					scope:dunlandfellsruler = {
						NOT = { any_war_enemy = { this = scope:thirdruler } }
					}
				}
				scope:dunlandfellsruler = { 
					create_alliance = scope:thirdruler
					scope:thirdruler = {
						add_opinion = {
							target = scope:dunlandfellsruler
							modifier = perk_negotiated_alliance_opinion
						}
					}
				}
			}
			if = {
				limit ={ 
					exists = scope:dathabharuler
					exists = scope:thirdruler
					scope:dathabharuler = {
						NOT = { any_war_enemy = { this = scope:thirdruler } }
					}
				}
				scope:dathabharuler = { 
					create_alliance = scope:thirdruler
					scope:thirdruler = {
						add_opinion = {
							target = scope:dathabharuler
							modifier = perk_negotiated_alliance_opinion
						}
					}
				}
			}
		}
		add_pressed_claim = title:k_dunland
		every_county = {
			limit = {
				kingdom = title:k_dunland
			}
			root = { add_pressed_claim = prev }
		}
	}
}

isengard.0211 = { # An Emissary from the White Wizard
	type = character_event
	title = isengard.0101.t
	desc = isengard.0101.desc
	theme = stewardship_domain_focus
	left_portrait = {
		character = root
		animation = personality_cynical
	}
	lower_center_portrait = scope:saruman
	right_portrait = {
		character = scope:warmonger
		animation = personality_forgiving
	}

	option = { # He shall have our allegiance
		name = isengard.0101.a
		trigger_event = {
			id = isengard.0102
			days = 5
		}
	}

	option = { # I will never bend the knee!
		name = isengard.0101.a
		trigger_event = {
			id = isengard.0102
			days = 5
		}
	}
}

isengard.0220 = { # The Infantry of the Uruk-hai
	type = character_event
	title = isengard.0220.t
	desc = isengard.0220.desc
	theme = martial
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:ugluk
		animation = anger
	}

	immediate = {
		create_character = {
			name = Ugluk
			gender = male
			age = 21
			culture = culture:isengard_urukhai
			faith = faith:lidless_eye	
			trait = stubborn
			trait = content
			trait = brave
			trait = education_martial_3
			trait = loyal
			trait = logistician
			trait = strong
			save_scope_as = ugluk
		}
	}

	option = { # They shall harry my enemies and swarm over the land!
		name = isengard.0220.a
		custom_tooltip = isengard.0220.a.tt
		custom_tooltip = isengard.0220.a.tt2
		add_character_flag = saruman_uruks_light_infantry
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 0
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 25
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}		
	}
	option = { # They shall be different from their forefathers, disciplined and well-armed!
		name = isengard.0220.b
		custom_tooltip = isengard.0220.b.tt
		custom_tooltip = isengard.0220.b.tt2
		add_character_flag = saruman_uruks_heavy_infantry
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 75
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}

	after = {
		trigger_event = isengard.0221
		scope:ugluk = { set_employer = root }
	}
}

isengard.0221 = { # The Archers of the Uruk-hai
	type = character_event
	title = isengard.0221.t
	desc = isengard.0221.desc
	theme = martial
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:lurtz
		animation = anger
	}

	immediate = {
		create_character = {
			name = Lurtz
			gender = male
			age = 22
			culture = culture:isengard_urukhai
			faith = faith:lidless_eye	
			trait = callous
			trait = zealous
			trait = brave
			trait = education_martial_3
			trait = hunter_2
			trait = forest_fighter
			trait = strong
			save_scope_as = lurtz
		}
	}

	option = { # Traditional bows, will be worth the investment.
		name = isengard.0221.a
		custom_tooltip = isengard.0221.a.tt
		add_character_flag = saruman_uruks_archers
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 0
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 25
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
	option = { # We shall darken the skies in an onslaught of crossbow bolts!
		name = isengard.0221.b
		custom_tooltip = isengard.0221.b.tt
		add_character_flag = saruman_uruks_crossbowmen
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 75
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}

	after = {
		trigger_event = isengard.0222
		scope:lurtz = { set_employer = root }
	}
}

isengard.0222 = { # My Army's Secret Weapon
	type = character_event
	title = isengard.0222.t
	desc = isengard.0222.desc
	theme = martial
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = { # All shall come to fear the fire of Isengard.
		name = isengard.0222.a
		custom_tooltip = isengard.0222.a.tt
		add_character_flag = saruman_uruks_fire_of_isengard
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 70
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 33
			}
		}
	}
	option = { # My Uruk-hai and their vicious wargs shall tear my enemies apart!
		name = isengard.0222.b
		custom_tooltip = isengard.0222.b.tt
		add_character_flag = saruman_uruks_cavalry
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 0
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 15
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 33
			}
		}
	}
	option = { # I shall use my darkest of crafts to create the ultimate warbeast...
		name = isengard.0222.c
		custom_tooltip = isengard.0222.c.tt
		add_character_flag = saruman_uruks_monstrosity
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 0
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 15
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 33
			}
		}
	}

	after = {
		trigger_event = {
			id = isengard.0223
			days = { 365 1000 }
		}
	}
}

isengard.0223 = { # The Most Loyal of Uruks
	type = character_event
	title = isengard.0223.t
	desc = isengard.0223.desc
	theme = martial
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:gorluk
		animation = anger
	}

	immediate = {
		create_character = {
			name = Gorl_uk
			gender = male
			age = 22
			culture = culture:isengard_urukhai
			faith = faith:lidless_eye	
			trait = wrathful
			trait = zealous
			trait = sadistic
			trait = education_martial_3
			trait = blademaster_2
			trait = aggressive_attacker
			trait = physique_good_2
			trait = urukhai_berserker
			trait = loyal
			save_scope_as = gorluk
		}
	}

	option = { # These Berserkers shall bring me the heads of my enemies!
		name = isengard.0223.a
		custom_tooltip = isengard.0223.a.tt
		add_character_flag = saruman_uruks_berserkers
	}

	after = {
		scope:gorluk = { set_employer = root }
	}
}