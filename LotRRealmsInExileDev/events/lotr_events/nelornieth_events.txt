namespace = nelornieth

##################################################
### Nelornieth by Esthiel and Bruice Underhill ###
##################################################

### Diplomatic missions
# 0001 -> 0009 / Initial event
# 0010 -> 0019 / Banquet events
# 0020 -> 0029 / Hunting events
# 0030 -> 0039 / Meditation events
# 0040 -> 0049 / Singing events
# 0100 - > 0109 / Final events

### Initial events

nelornieth.0001 = { # Embassy destination
    title = nelornieth.0001.t
    desc = nelornieth.0001.desc.intro
	desc = {
		triggered_desc = {
			trigger = { exists = scope:lasgalenking }
			desc = nelornieth.0001.desc.lasgalen
		}
		triggered_desc = {
			trigger = { exists = scope:lorienking }
			desc = nelornieth.0001.desc.lorien
		}
		triggered_desc = {
			trigger = { exists = scope:extraking }
			desc = nelornieth.0001.desc.random
		}
	}
	desc = nelornieth.0001.desc.end

    type = character_event
    theme = realm
    left_portrait = {
		character = root
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:chancellor
		animation = chancellor
	}

    immediate = {
		if = {
			limit = {
				exists = k_lasgalen.holder
				k_lasgalen.holder = { is_elf = yes }
				not = { k_lasgalen.holder = root }
			}
			k_lasgalen.holder = { save_scope_as = lasgalenking }
		}
		if = {
			limit = {
				exists = title:k_lothlorien.holder
				k_lothlorien.holder = { is_elf = yes }
				not = { k_lothlorien.holder = root }
			}
			k_lothlorien.holder = { save_scope_as = lorienking }
		}
		random_kingdom = {
			limit = {
				exists = holder
				not = { 
					holder = root 
					holder = scope:lasgalenking
					holder = scope:lorienking
					not = { geographical_region = middleearth_valinor }
				}
				holder = {
					is_elf = yes
				}
			}
			save_scope_as = extrakingdom
			holder = { save_scope_as = extraking }
		}
		cp:councillor_chancellor = { save_scope_as = chancellor }
	}

    option = { # I will send an embassy to Lasgalen
        name = nelornieth.0001.a
        custom_tooltip = nelornieth.0001.a.tt
		trigger = {
			exists = scope:lasgalenking
		}
		
		save_scope_value_as = {
			name = embassy
			value = flag:lasgalen
		}
		scope:lasgalenking = { save_scope_as = embassy_target }
        trigger_event = {
            id = nelornieth.0002
            days = 3
        }
    }
	
	option = { # I will send an embassy to Lorien
        name = nelornieth.0001.b
        custom_tooltip = nelornieth.0001.b.tt
		trigger = {
			exists = scope:lorienking
		}
		
		save_scope_value_as = {
			name = embassy
			value = flag:lorien
		}
		scope:lorienking = { save_scope_as = embassy_target }
        trigger_event = {
            id = nelornieth.0002
            days = 3
        }
    }
	
	option = { # I will send an embassy to a random Elvenking
        name = nelornieth.0001.c
        custom_tooltip = nelornieth.0001.c.tt
		trigger = {
			exists = scope:extraking
		}
		scope:extraking = { save_scope_as = embassy_target }
		save_scope_value_as = {
			name = embassy
			value = flag:random
		}
		
        trigger_event = {
            id = nelornieth.0002
            days = 3
        }
    }
	
	option = { # Maybe some other day
        name = nelornieth.0001.d
		remove_decision_cooldown = decision_nelornieth_diplo
    }
}

nelornieth.0002 = { # Choice of the ambassador
    title = nelornieth.0002.t
    desc = nelornieth.0002.desc

    type = character_event
    theme = realm
    left_portrait = {
		character = root
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:chancellor
		animation = personality_content
	}

    immediate = {
		root = { save_scope_as = nelorniethking }
		cp:councillor_chancellor = { save_scope_as = chancellor }
        cp:councillor_steward = { save_scope_as = steward }
        cp:councillor_spymaster = { save_scope_as = spymaster }
        cp:councillor_marshal = { save_scope_as = marshal }
		if = {
			limit = {
				root.primary_heir = { is_child_of = { root } }
			}
			root.primary_heir = { save_scope_as = prince }
		}
	}

    option = { # Send the chancellor
        name = nelornieth.0002.a
        custom_tooltip = nelornieth.0002.a.tt
        trigger = { exists = scope:chancellor }
        scope:chancellor = { save_scope_as = ambassador }
    }
	
    option = { # Send the steward
        name = nelornieth.0002.b
        custom_tooltip = nelornieth.0002.b.tt
        trigger = { exists = scope:steward }
        scope:steward = { save_scope_as = ambassador }
    }
	
    option = { # Send the marshal
        name = nelornieth.0002.c
        custom_tooltip = nelornieth.0002.c.tt
        trigger = { exists = scope:marshal }
        scope:marshal = { save_scope_as = ambassador }
    }
	
    option = { # Send the spymaster
        name = nelornieth.0002.d
        custom_tooltip = nelornieth.0002.d.tt
        trigger = { exists = scope:spymaster }
        scope:spymaster = { save_scope_as = ambassador }
    }
	
	option = { # Send my heir
		name = nelornieth.0002.e
        custom_tooltip = nelornieth.0002.e.tt
        trigger = { exists = scope:prince }
        scope:prince = { save_scope_as = ambassador }
    }
	
	after = {
		scope:embassy_target = {
			trigger_event = {
				id = nelornieth.0003
				days = 30
			}
		}
		set_variable = {
				name = mission_success
				value = 0
			}
	}
}


nelornieth.0003 = { # Ruler receives the ambassador
    title = nelornieth.0003.t
    desc = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:embassy = flag:lasgalen }
				nelornieth.0003.desc.lasgalen
			}
			triggered_desc = {
				trigger = { scope:embassy = flag:lorien }
				nelornieth.0003.desc.lorien
			}
			nelornieth.0003.desc.fallback
		}
	}

    type = character_event
    theme = realm
    left_portrait = {
		character = root
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:ambassador
		animation = personality_content
	}

    option = { #Let them in at once
        name = nelornieth.0003.a
    }
	
	option = { #Make the Avari wait
        name = nelornieth.0003.b
		scope:nelorniethking = { add_opinion = -10 }
    }
	
	after = {
		scope:nelorniethking = {
			trigger_event = {
				id = nelornieth.004.a
				days = 30
			}
		}
	}
}

nelornieth.0004 = { # Choose an activity - Step 1
    title = nelornieth.0004.t
    desc =  nelornieth.0004.desc
	type = character_event
    theme = realm
	override_background = { 
		event_background = army_camp
	}
	left_portrait = {
		character = scope:ambassador
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:embassy_target
		animation = personality_content
	}
	
	option = { #Organise a banquet
		name = nelornieth.0004.a
        custom_tooltip = nelornieth.0004.a
		add_character_flag = chose_banquet
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0010
				days = 5
			}
		}
	}
	
	option = { #Organise a hunt
		name = nelornieth.0004.b
        custom_tooltip = nelornieth.0004.b
		add_character_flag = chose_hunt
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0020
				days = 5
			}
		}
	}
	
	option = { #Organise a meditation
		name = nelornieth.0004.c
        custom_tooltip = nelornieth.0004.c
		add_character_flag = chose_meditation
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0030
				days = 5
			}
		}
	}
	
	option = { #Organise a singing recitation
		name = nelornieth.0004.d
        custom_tooltip = nelornieth.0004.d
		add_character_flag = chose_song
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0040
				days = 5
			}
		}
	}
}

nelornieth.0005 = { # Choose an activity - Step 2
    title = nelornieth.0005.t
    desc =  nelornieth.0005.desc
	type = character_event
    theme = realm
	override_background = { 
		event_background = army_camp
	}
	left_portrait = {
		character = scope:ambassador
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:embassy_target
		animation = personality_content
	}
	
	option = { #Organise a banquet
		name = nelornieth.0005.a
        custom_tooltip = nelornieth.0005.a
		trigger = {
			NOT = { has_character_flag = { chose_banquet } }
		}
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0010
				days = 5
			}
		}
	}
	
	option = { #Organise a hunt
		name = nelornieth.0005.b
        custom_tooltip = nelornieth.0005.b
		trigger = {
			NOT = { has_character_flag = { chose_hunt } }
		}
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0020
				days = 5
			}
		}
	}
	
	option = { #Organise a meditation
		name = nelornieth.0005.c
        custom_tooltip = nelornieth.0005.c
		trigger = {
			NOT = { has_character_flag = { chose_meditation } }
		}
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0030
				days = 5
			}
		}
	}
	
	option = { #Organise a singing recitation
		name = nelornieth.0005.d
        custom_tooltip = nelornieth.0005.d
		trigger = {
			NOT = { has_character_flag = { chose_song } }
		}
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0040
				days = 5
			}
		}
	}
	
	after = {
		remove_character_flag = chose_banquet
		remove_character_flag = chose_hunt
		remove_character_flag = chose_meditation
		remove_character_flag = chose_song
		add_character_flag = second_activity
	}
}

### Banquet events

nelornieth.0010 = { # Banquet event for target
    title = nelornieth.0010.t
    desc = nelornieth.0010.desc

    type = character_event
    theme = party
    left_portrait = {
		character = root
		animation = personality_rational
	}
    right_portrait = {
		character = scope:ambassador
		animation = toast_goblet
	}

    option = { #How exotic !
        name = nelornieth.0010.a
		scope:nelorniethking = {
			add_character_flag = banquet_success
			change_variable = {
				name = mission_success
				add = 2
			}
		}	
    }
	
	option = { #Meh
        name = nelornieth.0010.b	
    }
	
	option = { #These savages have no idea how to throw a banquet
        name = nelornieth.0010.c
		scope:nelorniethking = {
			add_character_flag = banquet_failure
			change_variable = {
				name = mission_success
				add = -1
			}
		}
    }
	
	after = {
		scope:nelorniethking = {
			trigger_event = {
				id = nelornieth.0011
				days = 5
			}
		}
	}
}

nelornieth.0011 = { # Banquet result event for liege
    title = nelornieth.0011.t
    desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = banquet_failure
				}
				desc = nelornieth.0011.desc.failure
			}
			triggered_desc = {
				trigger = {
					has_character_flag = banquet_success
				}
				desc = nelornieth.0011.desc.success
			}
			desc = nelornieth.0011.desc.boredom
		}
	}
    type = character_event
    theme = party
    left_portrait = {
		character = scope:ambassador
		animation = toast_goblet
	}
    right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { has_character_flag = banquet_failure }
			animation = disapproval
		}
		triggered_animation = {
			trigger = { has_character_flag = banquet_success }
			animation = toast_goblet
		}
		animation = boredom
	}

    option = { #Great Success !
        name = nelornieth.0011.a
		trigger = { has_character_flag = banquet_success }
		remove_character_flag = banquet_success
    }
	
	option = { #What a mess !
        name = nelornieth.0011.b
		trigger = { has_character_flag = banquet_failure }
		remove_character_flag = banquet_failure
    }
	
	option = { #Meh
        name = nelornieth.0011.c
		trigger = {
			NOR = {
				has_character_flag = banquet_success 
				has_character_flag = banquet_failure
			}
		}
    }
	
	after = {
		if = {
			limit = { has_character_flag = second_activity }
			remove_character_flag = second_activity
			trigger_event = {
				id = nelornieth.0100
				days = 5
			}
		}
		else = {
			trigger_event = {
				id = nelornieth.0005
				days = 5
			}
		}
	}
}

### Hunting events

nelornieth.0020 = { # Hunting event for target
    title = nelornieth.0020.t
    desc = nelornieth.0020.desc
    type = character_event
    theme = hunting
	override_background = {
		background = { # Lasgalen
			trigger = { { scope:embassy = flag:lasgalen } }
			event_background = wilderness_forest_deep
		}
		background = { # Lorien
			trigger = { { scope:embassy = flag:lorien } }
			event_background = wilderness_forest_mallorn
		}
		background = { # Random
			trigger = { { scope:embassy = flag:random } }
			event_background = wilderness_forest
		}
	}
    left_portrait = {
		character = root
		animation = personality_rational
	}
    right_portrait = {
		character = scope:ambassador
		animation = personality_bold
	}

    option = { #What an exciting experience !
        name = nelornieth.0020.a
		scope:nelorniethking = {
			add_character_flag = hunt_success
			change_variable = {
				name = mission_success
				add = 2
			}
		}
    }
	
	option = { #Meh
        name = nelornieth.0020.b	
    }
	
	option = { #These savages can't hunt properly
        name = nelornieth.0020.c
		scope:nelorniethking = {
			add_character_flag = hunt_failure
			change_variable = {
				name = mission_success
				add = -1
			}
		}
    }
	
	after = {
		scope:nelorniethking = {
			trigger_event = {
				id = nelornieth.0021
				days = 5
			}
		}
	}
}

nelornieth.0021 = { # Hunt result event for liege
    title = nelornieth.0021.t
    desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = hunt_failure
				}
				desc = nelornieth.0021.desc.failure
			}
			triggered_desc = {
				trigger = {
					has_character_flag = hunt_success
				}
				desc = nelornieth.0021.desc.success
			}
			desc = nelornieth.0021.desc.boredom
		}
	}
    type = character_event
    theme = hunting
	override_background = {
		background = { # Lasgalen
			trigger = { { scope:embassy = flag:lasgalen } }
			event_background = wilderness_forest_deep
		}
		background = { # Lorien
			trigger = { { scope:embassy = flag:lorien } }
			event_background = wilderness_forest_mallorn
		}
		background = { # Random
			trigger = { { scope:embassy = flag:random } }
			event_background = wilderness_forest
		}
	}
    left_portrait = {
		character = scope:ambassador
		animation = personality_bold
	}
    right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { has_character_flag = hunt_failure }
			animation = dismissal
		}
		triggered_animation = {
			trigger = { has_character_flag = hunt_success }
			animation = personality_compassionate
		}
		animation = boredom
	}

    option = { #Great Success !
        name = nelornieth.0021.a
		trigger = { has_character_flag = hunt_success }
		remove_character_flag = hunt_success
    }
	
	option = { #What a mess !
        name = nelornieth.0021.b
		trigger = { has_character_flag = hunt_failure }
		remove_character_flag = hunt_failure
    }
	
	option = { #Meh
        name = nelornieth.0021.c
		trigger = {
			NOR = {
				has_character_flag = hunt_success 
				has_character_flag = hunt_failure
			}
		}
    }
	
	after = {
		if = {
			limit = { has_character_flag = second_activity }
			remove_character_flag = second_activity
			trigger_event = {
				id = nelornieth.0100
				days = 5
			}
		}
		else = {
			trigger_event = {
				id = nelornieth.0005
				days = 5
			}
		}
	}
}

### Meditation events

nelornieth.0020 = { # Meditation event for target
    title = nelornieth.0030.t
    desc = nelornieth.0030.desc
    type = character_event
    theme = faith
	override_background = {
		background = { # Lasgalen
			trigger = { { scope:embassy = flag:lasgalen } }
			event_background = wilderness_forest_deep
		}
		background = { # Lorien
			trigger = { { scope:embassy = flag:lorien } }
			event_background = wilderness_forest_mallorn
		}
		background = { # Random
			trigger = { { scope:embassy = flag:random } }
			event_background = wilderness_forest
		}
	}
    left_portrait = {
		character = root
		animation = personality_rational
	}
    right_portrait = {
		character = scope:ambassador
		animation = personality_zealous
	}

    option = { #This is fascinating
        name = nelornieth.0030.a
		scope:nelorniethking = {
			add_character_flag = meditation_success
			change_variable = {
				name = mission_success
				add = 2
			}
		}
		
    }
	
	option = { #Meh
        name = nelornieth.0030.b	
    }
	
	option = { #Pah, what gibberish !
        name = nelornieth.0030.c
		scope:nelorniethking = {
			add_character_flag = meditation_failure
			change_variable = {
				name = mission_success
				add = -1
			}
		}
    }
	
	after = {
		if = {
			limit = { has_character_flag = second_activity }
			remove_character_flag = second_activity
			trigger_event = {
				id = nelornieth.0100
				days = 5
			}
		}
		else = {
			trigger_event = {
				id = nelornieth.0005
				days = 5
			}
		}
	}
}

nelornieth.0031 = { # Meditation result event for liege
    title = nelornieth.0031.t
    desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = meditation_failure
				}
				desc = nelornieth.0031.desc.failure
			}
			triggered_desc = {
				trigger = {
					has_character_flag = meditation_success
				}
				desc = nelornieth.0031.desc.success
			}
			desc = nelornieth.0031.desc.boredom
		}
	}
    type = character_event
    theme = faith
	override_background = {
		background = { # Lasgalen
			trigger = { { scope:embassy = flag:lasgalen } }
			event_background = wilderness_forest_deep
		}
		background = { # Lorien
			trigger = { { scope:embassy = flag:lorien } }
			event_background = wilderness_forest_mallorn
		}
		background = { # Random
			trigger = { { scope:embassy = flag:random } }
			event_background = wilderness_forest
		}
	}
    left_portrait = {
		character = scope:ambassador
		animation = personality_zealous
	}
    right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { has_character_flag = meditation_failure }
			animation = personality_cynical
		}
		triggered_animation = {
			trigger = { has_character_flag = meditation_success }
			animation = personality_zealous
		}
		animation = boredom
	}

    option = { #Great Success !
        name = nelornieth.0031.a
		trigger = { has_character_flag = meditation_success }
		remove_character_flag = meditation_success
    }
	
	option = { #What a mess !
        name = nelornieth.0031.b
		trigger = { has_character_flag = meditation_failure }
		remove_character_flag = meditation_failure
    }
	
	option = { #Meh
        name = nelornieth.0031.c
		trigger = {
			NOR = {
				has_character_flag = meditation_success 
				has_character_flag = meditation_failure
			}
		}
    }
	
	after = {
		if = {
			limit = { has_character_flag = second_activity }
			remove_character_flag = second_activity
			trigger_event = {
				id = nelornieth.0100
				days = 5
			}
		}
		else = {
			trigger_event = {
				id = nelornieth.0005
				days = 5
			}
		}
	}
}


### Song events

nelornieth.0040 = { # Song event for target
    title = nelornieth.0040.t
    desc = nelornieth.0040.desc
    type = character_event
    theme = party
    left_portrait = {
		character = root
		animation = personality_rational
	}
    right_portrait = {
		character = scope:ambassador
		animation = chancellor
	}

    option = { #This is fascinating
        name = nelornieth.0040.a
		scope:nelorniethking = {
			add_character_flag = song_success
			change_variable = {
				name = mission_success
				add = 2
			}
		}
		
    }
	
	option = { #Meh
        name = nelornieth.0040.b	
    }
	
	option = { #Pah, what gibberish !
        name = nelornieth.0040.c
		scope:nelorniethking = {
			add_character_flag = song_failure
			change_variable = {
				name = mission_success
				add = -1
			}
		}
    }
	
	after = {
		scope:nelorniethking = {
			trigger_event = {
				id = nelornieth.0041
				days = 5
			}
		}
	}
}

nelornieth.0041 = { # Meditation result event for liege
    title = nelornieth.0041.t
    desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = song_failure
				}
				desc = nelornieth.0041.desc.failure
			}
			triggered_desc = {
				trigger = {
					has_character_flag = song_success
				}
				desc = nelornieth.0041.desc.success
			}
			desc = nelornieth.0041.desc.boredom
		}
	}
    type = character_event
    theme = party
    left_portrait = {
		character = scope:ambassador
		animation = chancellor
	}
    right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { has_character_flag = song_failure }
			animation = dismissal
		}
		triggered_animation = {
			trigger = { has_character_flag = meditation_success }
			animation = chancellor
		}
		animation = boredom
	}

    option = { #Great Success !
        name = nelornieth.0041.a
		trigger = { has_character_flag = song_success }
		remove_character_flag = song_success
    }
	
	option = { #What a mess !
        name = nelornieth.0041.b
		trigger = { has_character_flag = song_failure }
		remove_character_flag = song_failure
    }
	
	option = { #Meh
        name = nelornieth.0041.c
		trigger = {
			NOR = {
				has_character_flag = song_success 
				has_character_flag = song_failure
			}
		}
    }
	
	after = {
		if = {
			limit = { has_character_flag = second_activity }
			remove_character_flag = second_activity
			trigger_event = {
				id = nelornieth.0100
				days = 5
			}
		}
		else = {
			trigger_event = {
				id = nelornieth.0005
				days = 5
			}
		}
	}
}

nelornieth.0100 = { # Conclusion
    title = nelornieth.0100.t
    desc = {
		first_valid = {
			triggered_desc = {
				trigger = { var:mission_success < 0  }
				nelornieth.0003.desc.failure
			}
			nelornieth.0100.desc.sucess
		}
	}

    type = character_event
    theme = realm
    left_portrait = {
		character = scope:ambassador
		animation = personality_content
	}
	right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { var:mission_success < 0 }
			animation = stress
		}
		animation = personality_honorable
	}

    option = { #Alliance
        name = nelornieth.0100.a
		trigger = {
			var:mission_success >=3
			not = { is_allied_to = scope:embassy_target }
		}
		create_alliance = {
			target = scope:embassy_target.tile
			allied_through_owner = root
			allied_through_target = scope:embassy_target
		}
    }
	
	option = { #A weapon
        name = nelornieth.0100.b
		trigger = {
			var:mission_success >=2
		}
		if = {
			limit = { scope:embassy = flag:lasgalen }
			create_artifact_lasgalendrim_spear_effect = { OWNER = this }
		}
		else_if = {
			limit = { scope:embassy = flag:lorien }
			create_artifact_galadhrim_bow_effect = { OWNER = this }
		}
		else_if = {
			limit = { scope:embassy = flag:random }
			create_artifact_elven_sword_effect = { OWNER = this }
		}
			
    }
	
	option = { #A warrior
		name = nelornieth.0100.c
		trigger = {
			var:mission_success >=0
		}
		create_character = {
			gender_female_chance = root_soldier_female_chance
			location = scope:embassy_target.location
			template = new_warrior_character
			faith = scope:embassy_target.faith
			culture = scope:embassy_target.culture
			save_scope_as = knight
		}
		add_visiting_courtier = scope:knight
		scope:knight = {
			select_and_move_to_pool_effect = yes
		}
    }
	
	option = { #Nothing
		name = nelornieth.0100.c
		trigger = {
			var:mission_success < 0
		}
		scope:embassy_target = {
			add_opinion = -15
		}
    }
	
	after = {
		remove_variable = mission_success
	}
}
