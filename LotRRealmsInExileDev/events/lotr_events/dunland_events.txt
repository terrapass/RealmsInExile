namespace = dunland

##################################################
# Restoring the Dunlendings
##################################################

dunland.1001 = {
	type = character_event
	title = dunland.1001.t
	desc = dunland.1001.desc
	theme = realm
	left_portrait = {
		character = scope:restorer
		animation = personality_honorable
	}

	immediate = {
		save_scope_as = restorer
		
		hidden_effect = { #Shifts Dunland, Isengard and Rohan into the Empire. Establishes Isengard as the middle kingdom, incorporating several duchies
			
			### Dunlendings spill into Western Rohan
			#Isengard Dunlendings
			title:c_gapofrohan = {
				if = {
					limit = {
						culture = { NOT = { has_cultural_pillar = heritage_dunlending } }        
					}
					set_county_culture = culture:isengard_dunlending
					set_county_faith = 	scope:restorer.faith
				}
			}
			title:c_grimslade = {
				if = {
					limit = {
						culture = { NOT = { has_cultural_pillar = heritage_dunlending } }        
					}
					set_county_culture = culture:isengard_dunlending
					set_county_faith = 	scope:restorer.faith
				}
			}
			title:c_helmsdeep = {
				if = {
					limit = {
						culture = { NOT = { has_cultural_pillar = heritage_dunlending } }        
					}
					set_county_culture = culture:isengard_dunlending
					set_county_faith = 	scope:restorer.faith
				}
				
			}
			# Herd-Folk Dunlendings
			title:c_westmarches = {
				set_county_culture = culture:herdfolk_dunlending
				set_county_faith = 	scope:restorer.faith
			}
			title:c_valesoftheadorn = {
				set_county_culture = culture:herdfolk_dunlending
				set_county_faith = 	scope:restorer.faith
			}
			# Hill Dunlendings
			title:c_westfold_vale = {
				if = {
					limit = {
						culture = { NOT = { has_cultural_pillar = heritage_dunlending } }        
					}
					set_county_culture = culture:hill_dunlending
					set_county_faith = 	scope:restorer.faith
				}
			}
			title:c_westemnet = {
				if = {
					limit = {
						culture = { NOT = { has_cultural_pillar = heritage_dunlending } }        
					}
					set_county_culture = culture:hill_dunlending
					set_county_faith = 	scope:restorer.faith
				}
			}
			
			# Innovations
			join_era = culture_era_high_medieval
			root.culture = { 
				culture_era_high_medieval
				get_random_innovation_from = culture:rohirrim
				get_random_innovation_from = culture:rohirrim
				get_random_innovation_from = culture:rohirrim
			}
			culture:hill_dunlending = { 
				culture_era_high_medieval
				get_random_innovation_from = culture:rohirrim
				get_random_innovation_from = culture:rohirrim
				get_random_innovation_from = culture:rohirrim
			}
			culture:herdfolk_dunlending = { 
				culture_era_high_medieval
				get_random_innovation_from = culture:rohirrim
				get_random_innovation_from = culture:rohirrim
				get_random_innovation_from = culture:rohirrim
			}
			culture:isengard_dunlending = {
				culture_era_high_medieval
				get_random_innovation_from = culture:rohirrim
				get_random_innovation_from = culture:rohirrim
				get_random_innovation_from = culture:rohirrim
			}
			#every_sub_realm_county = {
			#		limit = {
			#			culture = { has_cultural_pillar = heritage_hadorim}
			#			title_province = { geographical_region = special_rohan_t4a_kingdom }
			#		}
			#		add_county_modifier = {
			#			modifier = reclaim_britannia_culture_modifier
			#			days = 3650
			#		}
			#}			
		}
		
		if = {
			limit = {
				OR = {
					culture = culture:herdfolk_dunlending
					culture = culture:enedwaith_gwathuirim
					culture = culture:gwathlo_gwathuirim
					culture = culture:saralain
					culture = culture:eredrim
					culture = culture:andrastim
					culture = culture:donan
				}
			}
			give_nickname = nick_champion_of_the_hillmen
		}
		else_if = {
			give_nickname = nick_champion_of_dunland
		}
		add_character_modifier = { modifier = unifier_of_the_dunlendings_character_modifier }
		create_title_and_vassal_change = {
			type = created
			save_scope_as = change
			add_claim_on_loss = no
		}
		title:e_dunland = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
		#title:e_dunland = {	#commented out - dont see why it should become elective suddendly, leftover from danelaw decision
		#	add_title_law = feudal_elective_succession_law
		#}

		if = {
			limit = {
				NOT = { has_primary_title = title:e_dunland }
			}
			set_primary_title_to = title:e_dunland
		}
		
		#stuffthatwashiddenbefore
		title:k_dunland = {
				set_de_jure_liege_title = title:e_dunland
				change_development_progress = 150
			}
			title:k_rohan = {
				set_de_jure_liege_title = title:e_dunland
				change_development_progress = -150
			}
			title:k_isengard = {
				set_de_jure_liege_title = title:e_dunland
				change_development_progress = 250
			}
			# Establish Isengard as Middle Kingdom
			title:d_westmarches = {
				set_de_jure_liege_title = title:k_isengard
			}
			title:d_dathabha = {
				set_de_jure_liege_title = title:k_isengard
			}
			title:d_westfold = {
				set_de_jure_liege_title = title:k_isengard
			}
			title:d_isengard = {
				set_de_jure_liege_title = title:k_isengard
			}
	}
	
	option = {
		name = dunland.1001.a
		trigger_event = dunland.1003
		custom_tooltip = dunland.1001.tt

	}
}

# Players informed of the Danelaw being created
#dunland.1002 = {
#	type = character_event
#	title = dunland.1002.t
#	desc = {
#		first_valid = {
#			triggered_desc = {
#				trigger = {
#					OR = {
#						culture = { has_cultural_pillar = heritage_daen }
#						culture = { has_cultural_pillar = heritage_dunlending }
#					}
#				}
#				desc = dunland.1002.desc_same_culture
#			}
#			desc = dunland.1002.desc
#		}
#	}
#	theme = realm
#	left_portrait = {
#		character = scope:restorer
#		animation = personality_honorable
#	}
#
#	option = { # Not Danish
#		name = dunland.1002.a
#		trigger = {
#			NOT = { culture = { has_cultural_pillar = heritage_dunlending } }
#		}
#	}
#
#	option = { # Also Danish
#		name = dunland.1002.b
#		trigger = {
#			culture = { has_cultural_pillar = heritage_dunlending }
#		}
#	}
#
#	option = { # Give players close to restorer a chance to convert
#		name = dunland.1002.c
#		trigger = {
#			NOT = { root.culture = scope:restorer.culture }
#			OR = {
#				is_close_family_of = scope:restorer
#				is_vassal_of = scope:restorer
#			}
#		}
#		set_culture = scope:restorer.culture


#		hidden_effect = {
#			if = {
#				limit = { any_spouse = { is_landed = no } }
#				every_spouse = {
#					set_culture = culture:english
#				}
#			}
#			if = {
#				limit = {
#					any_close_family_member = {
#						is_landed = no
#						NOT = { is_spouse_of = prev }
#					}
#				}
#				every_close_family_member = {
#					limit = {
#						is_landed = no
#						NOT = { is_spouse_of = prev }
#					}
#					set_culture = culture:english
#				}
#			}
#		}


#	}
#}

dunland.1003  = {	### Choose new Capital # Edited version of Castamiri Gondor Event
	type = character_event
	title = dunland.1003.t
	desc = dunland.1003.desc
	theme = stewardship_duty_focus
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = { ###Isengard
		name = dunland.1003.a			
		ai_chance = 70
		get_title=title:d_isengard
		get_title=title:c_isengard
		title:e_dunland = {
			set_capital_county = title:c_isengard
		}
		set_realm_capital = title:c_isengard
		title:c_isengard = {
			add_county_modifier = dunland_capital_modifier
			years = 20
		}
		set_culture = culture:isengard_dunlending
		every_close_or_extended_family_member = {
			set_culture = culture:isengard_dunlending
		}
	}
	option = { ### Frecalund
		name = dunland.1003.b
		ai_chance = 20
		get_title=title:d_dunlandfells
		get_title=title:c_frecalund
		title:e_dunland = {
			set_capital_county = title:c_frecalund
		}
		set_realm_capital = title:c_frecalund
		title:c_frecalund = {
			add_county_modifier = dunland_capital_modifier
			years = 20
		}
	}
	option = { ### Kingstead
		name = dunland.1003.c
		ai_chance = 10
		get_title=title:d_thefolde
		get_title=title:c_kingstead
		get_title=title:c_firienfield
		get_title=title:c_eamund
		title:e_dunland = {
			set_capital_county = title:c_kingstead
		}
		set_realm_capital = title:c_kingstead
		title:c_kingstead = {
			add_county_modifier = dunland_capital_modifier
			years = 20
		}
	}
	
}