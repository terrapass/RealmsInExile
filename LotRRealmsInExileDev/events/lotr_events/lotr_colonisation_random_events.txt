##############################
# RANDOM COLONISATION EVENTS #
##############################

###############
## Terrain-Specific
# colonisation_random.0001 — [Forest] The Squirrel
# colonisation_random.0002 — [Forest] The White Hart
## Location-Specific
# colonisation_random.1001 — [Dwarf Road] The Burial
# colonisation_random.1002 — [Orc Lands] Goblin Raid
#
## General Events
# colonisation_random.2001 — Recruitment Drive

#########
# Ideas #
#########
# Foreign missionaries
# Foreign settlers

namespace = colonisation_random

## Terrain-Specific
colonisation_random.0001 = { # [Forest] The Squirrel
	type = character_event
	title = colonisation_random.0001.t
	desc = colonisation_random.0001.desc
	theme = realm

	left_portrait = {
		character = root
		animation = fear
	}

	override_background = {
		event_background = wilderness_forest
	}

	trigger = {
		NOT = { has_character_flag = had_event_colonisation_random_0001 }
		any_directly_owned_province = {
			has_holding_type = settlement_holding
			OR = {
				terrain = forest
				terrain = taiga
				terrain = deep_forest
				terrain = mallorn_forest
			}
		}
	}

	immediate = {
		add_character_flag = {
			flag = had_event_colonisation_random_0001
			years = 50
		}
		random_directly_owned_province = {
			limit = { 
				has_holding_type = settlement_holding
				OR = {
					terrain = forest
					terrain = taiga
					terrain = deep_forest
					terrain = mallorn_forest
				}
			}
			save_scope_as = colony_province
			county = { save_scope_as = colony_county }
		}
	}

	option = { # Attempt to fend off the squirrel
		name = colonisation_random.0001.a
		duel = {
			skill = prowess
			value = 8
			20 = {
				desc = colonisation_random.0001.a.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
				}
				show_as_tooltip = {
					add_prestige = 25
					add_character_modifier = {
						modifier = ate_good_meal
						years = 2
					}
				}
			}

			20 = {
				desc = colonisation_random.0001.a.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -19
				}
				increase_wounds_no_death_effect = { REASON = wild_animal }
				random = {
					chance = 25
					add_trait = one_eyed
				}
			}
		}
	}
	
	option = { # Call on your guards to help
		name = colonisation_random.0001.b
		add_prestige = -50
		add_dread = -10
	}
}

colonisation_random.0002 = { # [Forest] The White Hart
	type = character_event
	title = colonisation_random.0002.t
	desc = colonisation_random.0002.desc
	theme = realm

	left_portrait = {
		character = root
		animation = personality_bold
	}

	right_portrait = {
		character = scope:martial_companion
		animation = disbelief
	}

	override_background = {
		event_background = wilderness_forest
	}

	trigger = {
		NOT = { has_character_flag = had_event_colonisation_random_0002 }
		any_directly_owned_province = {
			has_holding_type = settlement_holding
			OR = {
				terrain = forest
				terrain = taiga
				terrain = deep_forest
				terrain = mallorn_forest
			}
		}
	}

	immediate = {
		play_music_cue = "mx_cue_touching_moment"
		add_character_flag = {
			flag = had_event_colonisation_random_0002
			years = 50
		}
		random_directly_owned_province = {
			limit = { 
				has_holding_type = settlement_holding
				OR = {
					terrain = forest
					terrain = taiga
					terrain = deep_forest
					terrain = mallorn_forest
				}
			}
			save_scope_as = colony_province
			county = { save_scope_as = colony_county }
		}
		random_martial_councillor = {
			limit = { is_ai = yes }
			save_scope_as = martial_companion
		}
		if = {
			limit = {
				NOT = { exists = scope:martial_companion }
			}
			random_courtier = {
				limit = { is_ai = yes }
				save_scope_as = martial_companion
			}
		}
	}

	option = { # Attempt to bring down the hart yourself - skilled hunter
		name = colonisation_random.0002.a
		trigger = {
			has_trait = lifestyle_hunter
		}
		duel = {
			skill = prowess
			value = 8
			15 = {
				desc = hunt.4007.a.success
				compare_modifier = {
					value = scope:duel_value
				}
				send_interface_toast = {		
					title = hunt.4007.a.success			
					add_character_modifier = {
						modifier = modifier_hunt_hunting_trophy
						days = 3650
					}
				}
			}
			8 = {
				desc = hunt.4007.a.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0.5
				}
				send_interface_toast = {	
					title = hunt.4007.a.failure				
					increase_wounds_effect = { REASON = hunting_accident }
				}
			}
			1 = {
				desc = hunt.4007.a.critical_failure
				send_interface_toast = {
					title = hunt.4007.a.critical_failure				
					death = {
						death_reason = death_hunting_accident
					}
				}
			}
		}
	}

	option = { # Attempt to bring down the hart yourself - no hunting experience
		name = colonisation_random.0002.a
		duel = {
			skill = prowess
			value = 12
			15 = {
				desc = colonisation_random.0002.a.success
				compare_modifier = {
					value = scope:duel_value
				}
				send_interface_toast = {		
					title = hunt.4007.a.success			
					add_character_modifier = {
						modifier = modifier_hunt_hunting_trophy
						days = 3650
					}
				}
			}
			8 = {
				desc = colonisation_random.0002.a.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0.5
				}
				send_interface_toast = {	
					title = hunt.4007.a.failure				
					increase_wounds_effect = { REASON = hunting_accident }
				}
			}
			1 = {
				desc = colonisation_random.0002.a.critical_failure
				send_interface_toast = {
					title = hunt.4007.a.critical_failure				
					death = {
						death_reason = death_hunting_accident
					}
				}
			}
		}
	}
	
	option = { # Quickly, companion, bring it down!
		name = colonisation_random.0002.b
		add_prestige = -150
		scope:martial_companion = {
			random_list = {
				85 = { 
					desc = colonisation_random.0002.b.success
					if = {
						limit = {
							can_add_hook = {
								target = root
								type = favor_hook
							}
						}
						add_hook = {
							type = favor_hook
							target = root
						}
					}
					else = {
						add_prestige = 150
					} 
				}
				10 = { 
					desc = colonisation_random.0002.b.failure
					if = {
						limit = {
							can_add_hook = {
								target = root
								type = favor_hook
							}
						}
						add_hook = {
							type = favor_hook
							target = root
						}
					}
					else = {
						add_prestige = 100
					}
					increase_wounds_effect = { REASON = hunting_accident }
					modifier = {
						add = 5
						prowess < 20
					}
					modifier = {
						add = 5
						prowess < 15
					}
					modifier = {
						add = 5
						prowess < 10
					}
					modifier = {
						add = 5
						prowess < 5
					}
				}
				5 = { 
					desc = colonisation_random.0002.b.critical_failure
					death = { death_reason = death_hunting_accident }
					modifier = {
						add = 5
						prowess < 20
					}
					modifier = {
						add = 5
						prowess < 15
					}
					modifier = {
						add = 5
						prowess < 10
					}
					modifier = {
						add = 5
						prowess < 5
					}
				}
			}
		}
	}

	option = { # The white hart is sacred, let us leave it be.
		name = colonisation_random.0002.c
		trigger = {
			faith = { has_doctrine = tenet_sanctity_of_nature }
		}
		add_piety = 150
	}

}

## Location-Specific
colonisation_random.1001 = { # [Dwarf Road] The Burial
	type = character_event
	title = colonisation_random.1001.t
	desc = colonisation_random.1001.desc
	theme = realm

	left_portrait = {
		character = root
		animation = personality_cynical
	}

	override_background = {
		event_background = wilderness_forest
	}

	trigger = {
		NOT = { has_character_flag = had_event_colonisation_random_1001 }
		any_directly_owned_province = {
			has_holding_type = settlement_holding
			OR = {
				county = title:c_dunmen_i_naugrim
				county = title:c_enedhmen_i_naugrim
				county = title:c_rhumen_i_naugrim
				county = title:c_senn_i_naugrim
			}
		}
	}

	immediate = {
		add_character_flag = {
			flag = had_event_colonisation_random_1001
		}
		random_directly_owned_province = {
			limit = { 
				has_holding_type = settlement_holding
				OR = {
					county = title:c_dunmen_i_naugrim
					county = title:c_enedhmen_i_naugrim
					county = title:c_rhumen_i_naugrim
					county = title:c_senn_i_naugrim
				}
			}
			save_scope_as = colony_province
			county = { save_scope_as = colony_county }
		}
	}

	option = { # Lift the stone
		name = colonisation_random.1001.a
		create_artifact = {	
			name = ancient_dwarven_battleaxe
			description = placeholder # Will be re-generated once decorations are added in the post-creation effects.
			visuals = axe
			type = axe 
			modifier = artifact_prowess_7_modifier
			modifier = artifact_hills_advantage_2_modifier
			modifier = artifact_mountains_advantage_3_modifier
			modifier = artifact_monthly_prestige_2_modifier
			wealth = 60
			quality = 60
			history = {
				location = scope:colony_province
				actor = root
				recipient = root
				type = discovered
			}
			save_scope_as = newly_created_artifact
		}
		scope:newly_created_artifact = {
			get_axe_decoration_effect = yes
			get_artifact_feature_references_effect = yes
			set_artifact_description = artifact_axe_description
		}
		if = {
			limit = { faith_is_evil = yes }
			add_piety = 50
		}
		else = {
			add_piety = -50
		}
		random = {
			chance = 50
			add_character_modifier = {
				modifier = cursed_spirits_modifier
				years = 30
			}
		}
	}
	
	option = { # Perhaps we'd better leave well alone
		name = colonisation_random.1001.b
		if = {
			limit = { faith_is_evil = no }
			add_piety = 150
		}
	}
}
colonisation_random.1002 = { # [Orc Lands] Goblin Raid
	type = character_event
	title = colonisation_random.1002.t
	desc = colonisation_random.1002.desc
	theme = realm

	left_portrait = {
		character = root
		animation = stress
	}

	right_portrait = {
		character = scope:martial_companion
		animation = personality_compassionate
	}

	override_background = {
		event_background = wilderness
	}

	trigger = {
		NOT = { has_character_flag = had_event_colonisation_random_1002 }
		any_directly_owned_province = {
			has_holding_type = settlement_holding
			OR = {
				duchy = title:d_men_i_naugrim
				duchy = title:d_grey_mountain_narrows
				duchy = title:d_drakkenvast
				kingdom = title:k_langwell
			}
		}
		is_orc = no
		NOT = { religion = { is_in_family = rf_forcesofevil } }
	}

	immediate = {
		add_character_flag = {
			flag = had_event_colonisation_random_1002
			years = 20
		}
		random_directly_owned_province = {
			limit = { 
				has_holding_type = settlement_holding
				OR = {
					duchy = title:d_men_i_naugrim
					duchy = title:d_grey_mountain_narrows
					duchy = title:d_drakkenvast
					kingdom = title:k_langwell
				}
			}
			save_scope_as = colony_province
			county = { save_scope_as = colony_county }
		}
		random_martial_councillor = {
			save_scope_as = martial_companion
		}
		if = {
			limit = {
				NOT = { exists = scope:martial_companion }
			}
			ordered_courtier = {
				order_by = martial
				save_scope_as = martial_companion
			}
		}
	}

	option = { # Devote a portion of your levies to defend the colony
		name = colonisation_random.1002.a
		add_character_modifier = {
			modifier = levies_guarding_colony_modifier
			years = 5
		}
	}
	
	option = { # Pay a mercenary band to do the job
		name = colonisation_random.1002.b
		remove_short_term_gold = 150
	}

	option = { # Evacuate the colony
		name = colonisation_random.1002.c
		make_settlement_county_wilderness = {
			COUNTY = scope:colony_county
		}
	}
}

## General Events
colonisation_random.2001 = { # Recruitment Drive
	type = character_event
	title = colonisation_random.2001.t
	desc = colonisation_random.2001.desc
	theme = realm

	left_portrait = {
		character = root
		animation = personality_rational
	}

	right_portrait = {
		character = scope:stewardship_companion
		animation = personality_compassionate
	}

	override_background = {
		event_background = market_tribal
	}

	trigger = {
		NOT = { has_character_flag = had_event_colonisation_random_2001 }
		any_directly_owned_province = {
			has_holding_type = settlement_holding
		}
	}

	immediate = {
		add_character_flag = {
			flag = had_event_colonisation_random_2001
			years = 20
		}
		random_directly_owned_province = {
			limit = { 
				has_holding_type = settlement_holding
			}
			save_scope_as = colony_province
			county = { save_scope_as = colony_county }
		}
		random_stewardship_councillor = {
			save_scope_as = stewardship_companion
		}
		if = {
			limit = {
				NOT = { exists = scope:stewardship_companion }
			}
			ordered_courtier = {
				order_by = stewardship
				save_scope_as = stewardship_companion
			}
		}
	}

	option = { # Send MaA to 'resettle' some locals
		name = colonisation_random.2001.a
		add_character_modifier = {
			modifier = maa_gathering_new_colonists_modifier
			years = 5
		}
	}
	
	option = { # Provide monetary incentives
		name = colonisation_random.2001.b
		remove_short_term_gold = 150
	}

	option = { # Offer religious blessings
		name = colonisation_random.2001.c
		trigger = {
			any_learning_councillor = {
				count > 0
			}
		}
		random_learning_councillor = {
			save_scope_as = realm_priest
		}
		scope:realm_priest = {
			if = {
				limit = {
					can_add_hook = {
						target = root
						type = favor_hook
					}
				}
				add_hook = {
					type = favor_hook
					target = root
				}
			}
		}
		add_piety = -100
	}
}

colonisation_random.2002 = { # A New Life
	type = character_event
	title = colonisation_random.2002.t
	desc = colonisation_random.2002.desc
	theme = realm

	left_portrait = {
		character = root
		animation = personality_rational
	}

	right_portrait = {
		character = scope:migrant
		animation = personality_bold
	}

	override_background = {
		event_background = market_tribal
	}	

	trigger = {
		NOT = { has_character_flag = had_event_colonisation_random_2002 }
		any_directly_owned_province = {
			has_holding_type = settlement_holding
			county = {
				any_neighboring_county = {
					NOT = { culture = root.culture }
					NOT = { culture = culture:wastelands }
					NOT = {
						AND = { 
							culture = { is_elf_culture = yes }
							scope:colony_county.culture = { is_elf_culture = no }
						}
					}
					NOT = {
						AND = {
							culture = { is_elf_culture = no }
							scope:colony_county.culture = { is_elf_culture = yes }
						}
					}
					NOT = {
						AND = { 
							culture = { is_orc_culture = yes }
							scope:colony_county.culture = { is_orc_culture = no }
						}
					}
					NOT = {
						AND = {
							culture = { is_orc_culture = no }
							scope:colony_county.culture = { is_orc_culture = yes }
						}
					}
				}
			}
		}
	}

	immediate = {
		add_character_flag = {
			flag = had_event_colonisation_random_2002
			years = 20
		}
		random_directly_owned_province = {
			limit = { 
				has_holding_type = settlement_holding
			}
			save_scope_as = colony_province
			county = { save_scope_as = colony_county }
		}
		scope:colony_county = {
			random_neighboring_county = {
				limit = {
					NOT = { culture = root.culture }
					NOT = { culture = culture:wastelands }
					NOT = {
						AND = { 
							culture = { is_elf_culture = yes }
							scope:colony_county.culture = { is_elf_culture = no }
						}
					}
					NOT = {
						AND = {
							culture = { is_elf_culture = no }
							scope:colony_county.culture = { is_elf_culture = yes }
						}
					}
					NOT = {
						AND = { 
							culture = { is_orc_culture = yes }
							scope:colony_county.culture = { is_orc_culture = no }
						}
					}
					NOT = {
						AND = {
							culture = { is_orc_culture = no }
							scope:colony_county.culture = { is_orc_culture = yes }
						}
					}
				}
				save_scope_as = origin_county
				culture = { save_scope_as = migrant_culture }
				faith = { save_scope_as = migrant_faith }
			}
		}
		create_character = {
			template = peasant_character
			dynasty = none
			culture = scope:migrant_culture
			faith = scope:migrant_daith
			location = scope:colony_province
			gender_female_chance = 50
			save_scope_as = migrant
			after_creation = {
				remove_trait = peasant_leader
			}
		}
	}

	option = { # Allow the migrants to bolster the settlement
		name = colonisation_random.2002.a
		scope:colony_county = {
			change_development_level = 1
			set_county_culture = scope:origin_county.culture
			set_county_faith = scope:origin_county.faith
		}
		culture = {
			change_cultural_acceptance = {
				target = scope:migrant_culture
				value = 5
				desc = allowed_migrants_in_colony
			}
		}
	}
	
	option = { # Drive the migrants away
		name = colonisation_random.2002.b
		culture = {
			change_cultural_acceptance = {
				target = scope:migrant_culture
				value = -5
				desc = forbade_migrants_in_colony
			}
		}
	}

	option = { # Force the migrants to work for us
		name = colonisation_random.2002.c
		culture = {
			change_cultural_acceptance = {
				target = scope:migrant_culture
				value = -10
				desc = enslaved_migrants_in_colony
			}
		}
		random_list = {
			80 = {
				send_interface_toast = {
					left_icon = root
					title = colonisation_random.2002.c.success
					scope:colony_county = { change_development_level = 1 }
				}
			}
			20 = {
				send_interface_toast = {
					left_icon = root
					title = colonisation_random.2002.c.failure
					make_settlement_county_wilderness = {
						COUNTY = scope:colony_county
					}
				}
			}
		}
	}

	after = {
		scope:migrant = {
			silent_disappearance_effect = yes
		}
	}
}