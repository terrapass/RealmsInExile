namespace = nazgul

######################################
# Nazgûl 0001-0002 Initiating Events #
######################################

nazgul.0001 = { # Nazgûl sighting reported
	title = nazgul.0001.t
	desc = nazgul.0001.desc
	theme = unfriendly
	override_background = { event_background = throne_room }
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		left_portrait = {
		character = scope:messenger
		animation = throne_room_bow_3
	}
	
	trigger = {
		any_character_artifact = { has_variable = ring_of_men }
		is_nazgul = no
		not = { has_character_flag = nazgul_revenge }
	}
	
	immediate = {
		capital_county = {
			add_county_modifier = peasants_spooked_by_nazgul
			years = 5
		}
		add_character_flag = nazgul_revenge
		random_character_artifact = {
			limit = { has_variable = ring_of_men }
			random_artifact_claimant = {
				limit = { is_nazgul = yes }
				save_scope_as = nazgul
			}
		}
		create_character_memory = {
			type = spooked_my_peasants
			participants = {
				nazgul = scope:nazgul
			}
		}
		if = {
			limit = {
				exists = cp:councillor_steward
				cp:councillor_steward = { is_available = yes }
			}
			cp:councillor_steward = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_marshal
				cp:councillor_marshal = { is_available = yes }
			}
			cp:councillor_marshal = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_chancellor
				cp:councillor_chancellor = { is_available = yes }
			}
			cp:councillor_chancellor = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_spymaster
				cp:councillor_spymaster = { is_available = yes }
			}
			cp:councillor_spymaster = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_court_chaplain
				cp:councillor_court_chaplain = { is_available = yes }
			}
			cp:councillor_court_chaplain = { save_scope_as = messenger }
		}
	}
	
	option = { 
		name = nazgul.0001.a
		add_stress = 50
		trigger_event = {
			id = nazgul.0002
			days = { 180 225 }
	}
}

nazgul.0002 = { # Nazgûl murders a courtier
	title = nazgul.0002.t
	desc = nazgul.0002.desc
	theme = death
	override_background = { event_background = throne_room }
	left_portrait = {
		character = root
		animation = disbelief
	}
	right_portrait = {
		left_portrait = {
		character = scope:messenger
		animation = paranoia
	}
	lower_center_portrait = {
		character = scope:victim
	}
	
	trigger = {
		any_character_artifact = { has_variable = ring_of_men }
		is_nazgul = no
	}
	
	immediate = {
		if = {
			limit = {
				exists = cp:councillor_steward
				cp:councillor_steward = { is_available = yes }
			}
			cp:councillor_steward = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_marshal
				cp:councillor_marshal = { is_available = yes }
			}
			cp:councillor_marshal = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_chancellor
				cp:councillor_chancellor = { is_available = yes }
			}
			cp:councillor_chancellor = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_spymaster
				cp:councillor_spymaster = { is_available = yes }
			}
			cp:councillor_spymaster = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_court_chaplain
				cp:councillor_court_chaplain = { is_available = yes }
			}
			cp:councillor_court_chaplain = { save_scope_as = messenger }
		}
		random_courtier = {
			limit = {
				basic_is_available_ai = yes
				NOT = { is_close_or_extended_family_of = root }
				has_friendly_relationship_with_root_trigger = yes
			}
			alternative_limit = {
				basic_is_available_ai = yes
				NOT = { is_close_or_extended_family_of = root }
				OR = { #You probably care more for highly skilled courtiers
					martial > high_skill_rating
					diplomacy > high_skill_rating
					intrigue > high_skill_rating
					learning > high_skill_rating
					stewardship > high_skill_rating
					prowess > high_skill_rating
				}
			}
			save_scope_as = victim
			show_as_tooltip = {
				death = {
					death_reason = death_murder
					killer = scope:nazgul
				}
			}
		}			
	}
	
	option = { #Tighten the guard
		name = nazgul.0002.a
		trigger_event = {
			on_action = nazgul_personality
			days = { 180 225 }
		}
	}
	
	option = { #Challenge the Nazgûl
		name = nazgul.0002.b
		configure_start_song_battle_effect = {
			SB_INITIATOR = root
			SB_ATTACKER = root
			SB_DEFENDER = scope:nazgul
			LOCALE = random_nice_day
			OUTPUT_EVENT = nazgul.0200
			INVALIDATION_EVENT = song_battle.0021
		}
	}
	
	option = { #Return the precious... NOOOOOOOOOOOOOOO
		name = nazgul.0002.c
		add_stress = 200
		random = {
			chance = 15
			add_trait = lunatic_1
		}
		trigger_event = {
			id = nazgul.0300
			days = { 5 }
	}
}

################################
# Nazgûl 0200-0203 Duel Events #
################################

nazgul.0200 = { #Nazgûl song battle outcome
	hidden = yes

	immediate = {
		scope:sb_victor = {
			add_character_modifier = {
				modifier = magical_supremacy_modifier
				days = 10
			}
		}
		configure_start_single_combat_effect = {
			SC_INITIATOR = scope:sb_victor
			SC_ATTACKER = scope:sb_victor
			SC_DEFENDER = scope:sb_loser
			FATALITY = no
			FIXED = no
			LOCALE = terrain_scope
			OUTPUT_EVENT = nazgul.0201
			INVALIDATION_EVENT = fp1_tbc.0102
		}
	}
}

nazgul.0201 = { Nazgûl duel outcome
	hidden = yes

	immediate = {
		if = {
			limit =  { scope:sc_victor = root }
			trigger_event = {
				id = nazgul.0202
				days = 1
			}
		}
		else_if = {
			trigger_event = {
				id = nazgul.0203
				days = 1
			}
		}
	}
}

nazgul.0202 = { #Victory !
	title = nazgul.0202.t
	desc = nazgul.0202.desc
	theme = battle
	override_background = { event_background = wilderness }
	left_portrait = {
		character = root
		animation = throne_room_cheer_2
	}
	right_portrait = {
		left_portrait = {
		character = scope:nazgul
		animation = rage
	}

	option = { #I'm invincible !
		name = nazgul.0202.a
		trigger_event = {
			on_action = nazgul_personality
			days = { 360 450 }
		}
	}
}

nazgul.0203 = { #Defeat !
	title = nazgul.0203.t
	desc = nazgul.0203.desc
	theme = battle
	override_background = { event_background = wilderness }
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:nazgul
		animation = duel_wield_weapon
	}

	option = { #It was always going to end this way, you knew that.
		name = nazgul.0202.a
		death = {
			killer = scope:nazgul
			death_reason = death_duel
		}
		random_character_artifact = {
			limit = {
				has_variable = ring_of_men
			}
			set_owner = {
				target = scope:nazgul
				history = {
					actor = root
					recipient = scope:nazgul
					type = won_in_duel
				}
			}
		}
	}
}

### Nazgul.0300 Living without the precious

nazgul.0300 = { #My PRECIOUSSSSSS!
	title = nazgul.0300.t
	desc = nazgul.0300.desc
	theme = mental_greak
	left_portrait = {
		character = root
		animation = grief
	}
	
	option = { #How can I live without the precious ?
		name = nazgul.0300.a
		if = {
			limit = { 
				not =  { has_trait = depressed_1 }
			}
			add_trait = depressed_1
		}
		else_if = {
			add_trait = infirm
		}
	}
}
