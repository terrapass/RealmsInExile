namespace = nazgul

################################
# Nazgûl 0001-0003 Main Events #
################################

nazgul.0001 = { # Nazgûl sighting reported
	title = nazgul.0001.t
	desc = nazgul.0001.desc
	theme = unfriendly
	override_background = { event_background = throne_room }
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		left_portrait = {
		character = scope:messenger
		animation = throne_room_bow_3
	}
	
	trigger = {
		any_character_artifact = { has_variable = ring_of_men }
		is_nazgul = no
		not = { has_character_flag = nazgul_revenge }
	}
	
	immediate = {
		capital_county = {
			add_county_modifier = peasants_spooked_by_nazgul
			years = 5
		}
		add_character_flag = nazgul_revenge
		random_character_artifact = {
			limit = { has_variable = ring_of_men }
			random_artifact_claimant = {
				limit = { is_nazgul = yes }
				save_scope_as = nazgul
			}
		}
		create_character_memory = {
			type = spooked_my_peasants
			participants = {
				nazgul = scope:nazgul
			}
		}
		if = {
			limit = {
				exists = cp:councillor_steward
				cp:councillor_steward = { is_available = yes }
			}
			cp:councillor_steward = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_marshal
				cp:councillor_marshal = { is_available = yes }
			}
			cp:councillor_marshal = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_chancellor
				cp:councillor_chancellor = { is_available = yes }
			}
			cp:councillor_chancellor = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_spymaster
				cp:councillor_spymaster = { is_available = yes }
			}
			cp:councillor_spymaster = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_court_chaplain
				cp:councillor_court_chaplain = { is_available = yes }
			}
			cp:councillor_court_chaplain = { save_scope_as = messenger }
		}
	}
	
	option = { 
		name = nazgul.0001.a
		add_stress = 50
		trigger_event = {
			id = nazgul.0002
			days = { 180 225 }
	}
}

nazgul.0002 = { # Nazgûl murders a courtier
	title = nazgul.0002.t
	desc = nazgul.0002.desc
	theme = death
	override_background = { event_background = throne_room }
	left_portrait = {
		character = root
		animation = disbelief
	}
	right_portrait = {
		left_portrait = {
		character = scope:messenger
		animation = paranoia
	}
	lower_center_portrait = {
		character = scope:victim
	}
	
	trigger = {
		any_character_artifact = { has_variable = ring_of_men }
		is_nazgul = no
	}
	
	immediate = {
		if = {
			limit = {
				exists = cp:councillor_steward
				cp:councillor_steward = { is_available = yes }
			}
			cp:councillor_steward = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_marshal
				cp:councillor_marshal = { is_available = yes }
			}
			cp:councillor_marshal = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_chancellor
				cp:councillor_chancellor = { is_available = yes }
			}
			cp:councillor_chancellor = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_spymaster
				cp:councillor_spymaster = { is_available = yes }
			}
			cp:councillor_spymaster = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_court_chaplain
				cp:councillor_court_chaplain = { is_available = yes }
			}
			cp:councillor_court_chaplain = { save_scope_as = messenger }
		}
		random_courtier = {
			limit = {
				basic_is_available_ai = yes
				NOT = { is_close_or_extended_family_of = root }
				has_friendly_relationship_with_root_trigger = yes
			}
			alternative_limit = {
				basic_is_available_ai = yes
				NOT = { is_close_or_extended_family_of = root }
				OR = { #You probably care more for highly skilled courtiers
					martial > high_skill_rating
					diplomacy > high_skill_rating
					intrigue > high_skill_rating
					learning > high_skill_rating
					stewardship > high_skill_rating
					prowess > high_skill_rating
				}
			}
			save_scope_as = victim
			show_as_tooltip = {
				death = {
					death_reason = death_murder
					killer = scope:nazgul
				}
			}
		}			
	}
	
	option = { #Tighten the guard
		name = nazgul.0002.a
		trigger_event = {
			on_action = nazgul_personality
			days = { 180 225 }
		}
	}
	
	option = { #Challenge the Nazgûl
		name = nazgul.0002.b
		configure_start_song_battle_effect = {
			SB_INITIATOR = root
			SB_ATTACKER = root
			SB_DEFENDER = scope:nazgul
			LOCALE = random_nice_day
			OUTPUT_EVENT = nazgul.0200
			INVALIDATION_EVENT = song_battle.0021
		}
	}
	
	option = { #Return the precious... NOOOOOOOOOOOOOOO
		name = nazgul.0002.c
		add_stress = 200
		random = {
			chance = 15
			add_trait = lunatic_1
		}
		trigger_event = {
			id = nazgul.0300
			days = { 5 }
	}
}

nazgul.0003 = { # Nazgûl attacks a loved one
	title = nazgul.0003.t
	desc = {
		desc = nazgul.0003.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:victim = { is_alive = yes }
				}
				desc = nazgul.0003.desc.black_breath
			}
			desc = nazgul.0003.desc.death
		}
	}
	theme = death
	override_background = { event_background = throne_room }
	left_portrait = {
		character = root
		animation = grief
	}
	right_portrait = {
		left_portrait = {
		character = scope:messenger
		animation = paranoia
	}
	lower_center_portrait = {
		character = scope:victim
	}
	
	trigger = {
		any_character_artifact = { has_variable = ring_of_men }
		is_nazgul = no
	}
	
	immediate = {
		if = {
			limit = {
				exists = cp:councillor_steward
				cp:councillor_steward = { is_available = yes }
			}
			cp:councillor_steward = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_marshal
				cp:councillor_marshal = { is_available = yes }
			}
			cp:councillor_marshal = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_chancellor
				cp:councillor_chancellor = { is_available = yes }
			}
			cp:councillor_chancellor = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_spymaster
				cp:councillor_spymaster = { is_available = yes }
			}
			cp:councillor_spymaster = { save_scope_as = messenger }
		}
		else_if = {
			limit = {
				exists = cp:councillor_court_chaplain
				cp:councillor_court_chaplain = { is_available = yes }
			}
			cp:councillor_court_chaplain = { save_scope_as = messenger }
		}
		random_courtier = {
			limit = {
				OR = {
					is_of_major_interest_to_root_trigger = yes
					is_of_minor_interest_to_root_trigger = yes
				}
			}
			alternative_limit = {
				basic_is_available_ai = yes
				or = {
					is_close_or_extended_family_of = root
					is_consort_of = root
				}
			}
			save_scope_as = victim
			random = {
				4 = { add_character_modifier = black_breath_modifier }
				4 = { 
					death = {
						killer = scope:nazgul
						death_reason = murder
					}
				}
			}
		}			
	}
	
	option = { #Tighten the guard
		name = nazgul.0002.a
		trigger_event = {
			on_action = nazgul_personality
			days = { 180 225 }
		}
	}
	
	option = { #Challenge the Nazgûl
		name = nazgul.0002.b
		configure_start_song_battle_effect = {
			SB_INITIATOR = root
			SB_ATTACKER = root
			SB_DEFENDER = scope:nazgul
			LOCALE = random_nice_day
			OUTPUT_EVENT = nazgul.0200
			INVALIDATION_EVENT = song_battle.0021
		}
	}
}

#######################################
# Nazgûl 0301-0399 Personality Events #
#######################################

nazgul.0301 = { # Paranoia
	title = nazgul.0301.t
	desc = nazgul.0301.desc
	theme = mental_break
	override_background = { event_background = throne_room }
	left_portrait = {
		character = root
		animation = paranoia
	}
	
	trigger = {
		not = { has_trait = paranoid }
		or = {
			has_trait = trusting
			has_trait = craven
			has_trait = brave
			has_trait = patient
			has_trait = impatient
		}
	}
	
	immediate = { add_stress = 75 }
	
	option = {
		name = nazgul.0301.a
		remove_trait = trusting
		add_trait_force_tooltip = paranoid
	}
	
	option = {
		trigger = { 
			not = { has_trait = trusting } 
			has_trait = craven
		}
		name = nazgul.0301.b
		remove_trait = craven
		add_trait_force_tooltip = paranoid
	}
	
	option = {
		trigger = { 
			not = { has_trait = trusting } 
			has_trait = brave
		}
		name = nazgul.0301.c
		remove_trait = brave
		add_trait_force_tooltip = paranoid
	}
	
	option = {
		trigger = { 
			not = { has_trait = trusting } 
			has_trait = patient
		}
		name = nazgul.0301.d
		remove_trait = patient
		add_trait_force_tooltip = paranoid
	}
		
	option = {
		trigger = { 
			not = { has_trait = trusting } 
			has_trait = impatient
		}
		name = nazgul.0301.e
		remove_trait = impatient
		add_trait_force_tooltip = paranoid
	}
	
	after = {
		trigger_event = {
		id = nazgul.0003
		days = { 180 225 }
		}
	}
}

nazgul.0302 = { # Sadism
	title = nazgul.0302.t
	desc = nazgul.0302.desc
	theme = mental_break
	override_background = { event_background = throne_room }
	left_portrait = {
		character = root
		animation = personality_callous
	}
	
	trigger = {
		not = { has_trait = sadist }
		or = {
			has_trait = compassionate
			has_trait = callous
			has_trait = arrogant
			has_trait = humble
			has_trait = diligent
			has_trait = lazy
		}
	}
	
	immediate = { add_stress = 75 }
	
	option = {
		trigger = { has_trait = compassionate } 
		name = nazgul.0302.a
		remove_trait = compassionate
		add_trait_force_tooltip = sadist
	}
	
	option = {
		trigger = {
			has_trait = callous
		}
		name = nazgul.0302.b
		remove_trait = callous
		add_trait_force_tooltip = sadist
	}
	
	option = {
		trigger = { 
			nor = { 
				has_trait = compassionate 
				has_trait = callous
			} 
			has_trait = arrogant
		}
		name = nazgul.0302.c
		remove_trait = arrogant
		add_trait_force_tooltip = sadist
	}
	
	option = {
		trigger = { 
			nor = { 
				has_trait = compassionate 
				has_trait = callous
			} 
			has_trait = arrogant
		}
		name = nazgul.0302.d
		remove_trait = humble
		add_trait_force_tooltip = sadist
	}
		
	option = {
		trigger = { 
			nor = { 
				has_trait = compassionate 
				has_trait = callous
			} 
			has_trait = arrogant
		}
		name = nazgul.0302.e
		remove_trait = diligent
		add_trait_force_tooltip = sadist
	}
	
	option = {
		trigger = { 
			nor = { 
				has_trait = compassionate 
				has_trait = callous
			} 
			has_trait = arrogant
		}
		name = nazgul.0302.f
		remove_trait = lazy
		add_trait_force_tooltip = sadist
	}
	
	after = {
		trigger_event = {
		id = nazgul.0003
		days = { 180 225 }
		}
	}
}

################################
# Nazgûl 0200-0203 Duel Events #
################################

nazgul.0200 = { #Nazgûl song battle outcome
	hidden = yes

	immediate = {
		scope:sb_victor = {
			add_character_modifier = {
				modifier = magical_supremacy_modifier
				days = 10
			}
		}
		configure_start_single_combat_effect = {
			SC_INITIATOR = scope:sb_victor
			SC_ATTACKER = scope:sb_victor
			SC_DEFENDER = scope:sb_loser
			FATALITY = no
			FIXED = no
			LOCALE = terrain_scope
			OUTPUT_EVENT = nazgul.0201
			INVALIDATION_EVENT = fp1_tbc.0102
		}
	}
}

nazgul.0201 = { Nazgûl duel outcome
	hidden = yes

	immediate = {
		if = {
			limit =  { scope:sc_victor = root }
			trigger_event = {
				id = nazgul.0202
				days = 1
			}
		}
		else_if = {
			trigger_event = {
				id = nazgul.0203
				days = 1
			}
		}
	}
}

nazgul.0202 = { #Victory !
	title = nazgul.0202.t
	desc = nazgul.0202.desc
	theme = battle
	override_background = { event_background = wilderness }
	left_portrait = {
		character = root
		animation = throne_room_cheer_2
	}
	right_portrait = {
		left_portrait = {
		character = scope:nazgul
		animation = rage
	}

	option = { #I'm invincible !
		name = nazgul.0202.a
		trigger_event = {
			on_action = nazgul_personality
			days = { 360 450 }
		}
	}
}

nazgul.0203 = { #Defeat !
	title = nazgul.0203.t
	desc = nazgul.0203.desc
	theme = battle
	override_background = { event_background = wilderness }
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:nazgul
		animation = duel_wield_weapon
	}

	option = { #It was always going to end this way, you knew that.
		name = nazgul.0202.a
		death = {
			killer = scope:nazgul
			death_reason = death_duel
		}
		random_character_artifact = {
			limit = {
				has_variable = ring_of_men
			}
			set_owner = {
				target = scope:nazgul
				history = {
					actor = root
					recipient = scope:nazgul
					type = won_in_duel
				}
			}
		}
	}
}

### Nazgul.0300 Living without the precious

nazgul.0300 = { #My PRECIOUSSSSSS!
	title = nazgul.0300.t
	desc = nazgul.0300.desc
	theme = mental_greak
	left_portrait = {
		character = root
		animation = grief
	}
	
	option = { #How can I live without the precious ?
		name = nazgul.0300.a
		remove_character_flag = nazgul_revenge
		if = {
			limit = { 
				not =  { has_trait = depressed_1 }
			}
			add_trait = depressed_1
		}
		else_if = {
			add_trait = infirm
		}
	}
}