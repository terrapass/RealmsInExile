# Exploring Histories activity

activity_explore_history = {

	# is_shown = {
		# is_landed = yes
		# highest_held_title_tier > tier_barony
		# is_in_valinor = no
		# OR = {
			# AND = {
				# religion = { is_in_family = rf_eruhini }
				# OR = {
					# lotr_has_numenorean_culture_trigger = yes
					# is_eldar = yes
				# }
			# }
			# faith = {
				# has_doctrine = tenet_adunaic_birthright
			# }
		# }
	# }
	
	# can_start_showing_failures_only = {
		# is_available_adult = yes
	# }
	
	# is_valid = {
		# scope:host = {
			# is_alive = yes
			# is_capable_adult = yes
			# is_imprisoned = no
			# is_landed = yes
			# NOT = { is_incapable = yes }
		# }
		##Converting mid-exploratiion is a big no-no.
		# scope:activity = {
			# OR = {
				# NOT = { has_variable = starting_faith }
				# scope:host.faith = var:starting_faith
			# }
		# }
	# }
	
	# on_host_death = {
		# every_attending_character = {
			# limit = { is_alive = yes }
			# trigger_event = {
				id = feast.5003
				# id = explore_history.0063
				# days = 1 # So you don't get spammed
			# }
		# }
		##Code sends your entourage home on invalidated
		# scope:activity.var:host_var = {
			##Saving the title for loc
			# primary_title = { save_scope_as = host_title }
			##Inform your heir if you have one
			# player_heir ?= {
				# trigger_event = {
					##id = feast.0800
					# id = explore_history.0070
					# days = 1
				# }
			# }
		# }
	# }
	
	# on_invalidated = {
		# if = {
			# limit = {
				# scope:host = { is_imprisoned = yes }
			# }
			##Host has been imprisoned
			# every_attending_character = {
				# limit = {
					# NOT = { this  = scope:host }
				# }
				##trigger_event = feast.5005
				# trigger_event = explore_history.0065
			# }
			# scope:host = { 
				##trigger_event = feast.5004 
				# trigger_event = explore_history.0064
			# }
		# }
		# if = {
			# limit = {
				# scope:host = { is_incapable = yes }
			# }
			# scope:activity = {
				# activity_type = { save_scope_as = activity_type }
			# }
			# scope:host = {
				# trigger_event = activity_system.0330
			# }
			# every_attending_character = {
				# limit = { NOT = { this = scope:host } }
				# trigger_event = activity_system.0331
			# }
		# }
		##Host becomes unlanded
		# if = {
			# limit = {
				# scope:host = { is_landed = no }
			# }
			# scope:activity = {
				# activity_type = { save_scope_as = activity_type }
			# }
			# every_attending_character = {
				# trigger_event = activity_system.0320
			# }
		# }
	# }
	
	# is_location_valid = {
		# has_holding = yes
	
		##You only get to visit any particular archive once every 5 years
		# custom_tooltip = { 
			# text = activity_explore_history.is_location_valid.recently_visited
			# NOT = {
				# scope:host = {
					# any_memory = {
						# has_variable = history_destination
						# var:explore_history_destination = root #root is the province we're checking
						# NOT = { scope:host.capital_province = root }
						# memory_age_years < 5
					# }
				# }
			# }
		# }
		
		##You cannot consult the archives of a hostile faith ruler
		# custom_tooltip = { 
			# text = activity_explore_history.is_location_valid.wrong_holder_faith
			# trigger_if = {
				# limit = { scope:host.religion = { is_in_family = rf_eruhini } }
				# var:explore_history_destination.holder = { faith_is_good = yes }
			# }
			# trigger_else = {
				# var:explore_history_destination.holder = { faith_is_good = no }
			# }
		# }

		##If you are supposed to be the realm's reserve ruler, then you can't take a foreign trip.
		# trigger_if = {
			# limit = {
				# scope:host = { bannable_serving_diarch_trigger = yes }
				# NOT = { scope:host.capital_province = root }
			# }
			# custom_tooltip = {
				# text = activity_explore_history.serving_diarch
				# county.holder = {
					# any_liege_or_above = { this = scope:host.liege }
				# }
			# }
		# }
	# }
	
	
	##Defining appropriate locations
	# every_in_list = {
		# list = realm
		# add_to_list = archives
	# }
	
	# if = {
		# limit = { scope:host = { is_human = yes } }
		# province:199 = { add_to_list = archives } #Minas Tirith
		# province:315 = { add_to_list = archives } #Dol Amroth
		# province:264 = { add_to_list = archives } #Pelargir
		# province:20 = { add_to_list = archives } #Isengard
		# if = {
			# limit = {
				# province:202 = { has_building = wonder_osgiliath_05 }
				# province:203 = { has_building = wonder_osgiliath_05 }
			# }
			# province:202 = { add_to_list = archives } #Osgiliath
		# }
		# if = {
			# limit = {
				# title:c_minas_ithil = {
					# NOR = { 
						# has_county_modifier = morgul_corruption_modifier
						# has_county_modifier = fading_morgul_corruption_modifier
					# }
				# }
			# }
			# province:226 = { add_to_list = archives } #Minas Ithil
		# }
		# if = {
			# limit = {
				# province:236 = { has_building = wonder_palace_of_ithilien }
			# }
			# province:236 = { add_to_list = archives } #Emyn Arnen
		# }
		##Annuminas
		##Fornost
		# province:2493 = { add_to_list = archives } #Zadan an-Adûn
		# province:2513 = { add_to_list = archives } #Kadar an-Kharadûn
		# province:819 = { add_to_list = archives } #Umbar
		# if = {
			# limit = {
				# province:1018 = { has_building = wonder_arminalethor_01 }
			# }
			# province:1018 = { add_to_list = archives } #Tol Uialgaer
		# }
		# province:1791 = { add_to_list = archives } #Nilulonde
		# province:1644 = { add_to_list = archives } #Korlea
		# province:1542 = { add_to_list = archives } #Hazaj Tollin
		# province:1731 = { add_to_list = archives } #Urezayan
	# }
	# else_if = {
		# limit = { scope:host = { is_elf = yes } }
		# province:3108 = { add_to_list = archives } #Caras Galadhon
		# province:3216 = { add_to_list = archives } #Aradhrynd
		# if = {
			# limit = {
				# province:3338 = { 
					# OR = {
						# has_building = wonder_amon_lanc_01
						# has_building = wonder_amon_lanc_03
					# }
				# }
			# }
			# province:3338 = { add_to_list = archives } #Amon Lanc
		# }
		# if = {
			# limit = {
				# province:420 = { 
					# OR = {
						# has_building = wonder_edhellond_01
						# has_building = wonder_edhellond_03
					# }
				# }
			# }
			# province:420 = { add_to_list = archives } #Edhellond
		# }
		# if = {
			# limit = {
				# province:3264 = { 
					# OR = {
						# has_building = wonder_amarthrynd_01
						# has_building = wonder_amarthrynd_03
					# }
				# }
			# }
			# province:3264 = { add_to_list = archives } #Amardhrynd
		# }
		##Imladris
		##Mithlond
		##Ost-in-Edhil
	# }
	
	
	
	###################
	##PARAMETERS
	###################

	# is_grand_activity = no
	# is_single_location = yes

	# province_filter = archives
	# ai_province_filter = capital

	# max_route_deviation_mult = 2.0

	
	# province_description = {
		# desc = activity_explore_history_province_desc
		##+++ / triple plus good
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_angrenost_02 }
			# desc = activity_explore_history_province_desc_wonder_angrenost_upgraded
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_minas_anor_02 }
			# desc = activity_explore_history_province_wonder_minas_anor_upgraded
		# }
		# triggered_desc = {
			# trigger = {
				# OR = {
					# has_building = wonder_minas_ithil_01
					# has_building = wonder_minas_ithil_03
				# }
			# }
			# desc = activity_explore_history_province_desc_wonder_minas_ithil
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_osgiliath_05 }
			# desc = activity_explore_history_province_desc_wonder_osgiliath
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_palace_of_ithilien }
			# desc = activity_explore_history_province_desc_wonder_palace_of_ithilien
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_port_of_pelargir_02 }
			# desc = activity_explore_history_province_desc_wonder_port_of_pelargir_upgraded
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_dol_amroth_02 }
			# desc = activity_explore_history_province_desc_wonder_dol_amroth_upgraded
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_umbar_02 }
			# desc = activity_explore_history_province_desc_wonder_umbar_upgraded
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_arminalethor_01 }
			# desc = activity_explore_history_province_desc_wonder_arminalethor
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_nilulonde_02 }
			# desc = activity_explore_history_province_desc_wonder_nilulonde_upgraded
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_marath_kharadune_02 }
			# desc = activity_explore_history_province_desc_wonder_marath_kharadune_upgraded
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_caras_galadhon }
			# desc = activity_explore_history_province_desc_wonder_caras_galadhon
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = wonder_aradhrynd }
			# desc = activity_explore_history_province_desc_wonder_aradhrynd
		# }
		# triggered_desc = {
			# trigger = { 
				# OR = {
					# has_building = wonder_amarthrynd_01
					# has_building = wonder_amarthrynd_03
				# }
			# }
			# desc = activity_explore_history_province_desc_wonder_amarthrynd
		# }
		# triggered_desc = {
			# trigger = { 
				# OR = {
					# has_building = wonder_edhellond_01
					# has_building = wonder_edhellond_03
				# }
			# }
			# desc = activity_explore_history_province_desc_wonder_edhellond
		# }
		# triggered_desc = {
			# trigger = { 
				# OR = {
					# has_building = wonder_amon_lanc_01
					# has_building = wonder_amon_lanc_03
				# }
			# }
			# desc = activity_explore_history_province_desc_wonder_amon_lanc
		# }
		
		
		##++ / double plus good
		# triggered_desc = {
			# trigger = { has_building = wonder_angrenost_01 }
			# desc = activity_explore_history_province_desc_wonder_angrenost
		# }
		# triggered_desc = {
			# trigger = { has_building = wonder_minas_anor_01 }
			# desc = activity_explore_history_province_wonder_minas_anor
		# }
		# triggered_desc = {
			# trigger = { has_building = wonder_port_of_pelargir_01 }
			# desc = activity_explore_history_province_wonder_port_of_pelargir
		# }
		# triggered_desc = {
			# trigger = { has_building = wonder_dol_amroth_01 }
			# desc = activity_explore_history_province_wonder_dol_amroth
		# }
		# triggered_desc = {
			# trigger = { has_building = wonder_nilulonde_01 }
			# desc = activity_explore_history_province_wonder_nilulonde
		# }
		# triggered_desc = {
			# trigger = { has_building = wonder_haven_korlea }
			# desc = activity_explore_history_province_wonder_haven_korlea
		# }
		# triggered_desc = {
			# trigger = { has_building = wonder_marath_kharadune_01 }
			# desc = activity_explore_history_province_wonder_marath_kharadune
		# }
		# triggered_desc = {
			# trigger = { has_building = wonder_lighthouse_of_adunazain }
			# desc = activity_explore_history_province_wonder_lighthouse_of_adunazain
		# }
		
		##+ / plus good
		# triggered_desc = {
			# trigger = { has_building_or_higher = building_library_01 }
			# desc = activity_explore_history_province_desc_library
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = military_academy_01 }
			# desc = activity_explore_history_province_desc_military_academy
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = monastic_schools_01 }
			# desc = activity_explore_history_province_desc_monastic_schools
		# }
		# triggered_desc = {
			# trigger = { has_building_or_higher = citadel_01 }
			# desc = activity_explore_history_province_desc_citadel
		# }
	# }
	
	# max_province_icons = 8
	
	# province_score = {
		# value = 0
		##BUILDINGS
		##Triple good / +++
		# if = {
			# limit = { has_building_or_higher = wonder_angrenost_02 }
			# add = 150
		# }
		# if = {
			# limit = { has_building = wonder_angrenost_01 }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_minas_anor_02 }
			# add = 150
		# }
		# if = {
			# limit = { has_building = wonder_minas_anor_01 }
			# add = 100
		# }
		# if = {
			# limit = { has_building = wonder_minas_ithil_01 }
			# add = 150
		# }
		# if = {
			# limit = { has_building = wonder_minas_ithil_03 }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_osgiliath_05 }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_palace_of_ithilien }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_port_of_pelargir_02 }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_dol_amroth_02 }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_umbar_02 }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_arminalethor_01 }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_nilulonde_02 }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_marath_kharadune_02 }
			# add = 100
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_caras_galadhon }
			# add = 150
		# }
		# if = {
			# limit = { has_building_or_higher = wonder_aradhrynd }
			# add = 150
		# }
		# if = {
			# limit = { has_building = wonder_amarthrynd_01 }
			# add = 150
		# }
		# if = {
			# limit = { has_building = wonder_amarthrynd_03 }
			# add = 100
		# }
		# if = {
			# limit = { has_building = wonder_edhellond_01}
			# add = 150
		# }
		# if = {
			# limit = { has_building = wonder_edhellond_03 }
			# add = 100
		# }
		# if = {
			# limit = { has_building = wonder_amon_lanc_01 }
			# add = 150
		# }
		# if = {
			# limit = { has_building = wonder_amon_lanc_03 }
			# add = 100
		# }
		
		##Double good / ++
		# if = {
			# limit = { has_building = wonder_port_of_pelargir_01 }
			# add = 50
		# }
		# if = {
			# limit = { has_building = wonder_dol_amroth_01 }
			# add = 50
		# }
		# if = {
			# limit = { has_building = wonder_nilulonde_01 }
			# add = 50
		# }
		# if = {
			# limit = { has_building = wonder_haven_korlea }
			# add = 50
		# }
		# if = {
			# limit = { has_building = wonder_marath_kharadune_01 }
			# add = 50
		# }
		# if = {
			# limit = { has_building = wonder_lighthouse_of_adunazain }
			# add = 50
		# }
		
		
		##Good / +
		# if = {
			# limit = { has_building_or_higher = building_library_01 }
			# add = 25
		# }
		# if = {
			# limit = { has_building_or_higher = military_academy_01 }
			# add = 25
		# }
		# if = {
			# limit = { has_building_or_higher = monastic_schools_01 }
			# add = 25
		# }
		# if = {
			# limit = { has_building_or_higher = citadel_01 }
			# add = 25
		# }
		
		##Bad / -
		# triggered_desc = {
			# trigger = {
				# exists = county
				# county.development_level < bad_development_level
			# }
			# desc = activity_explore_history_province_desc_development
		# }
	# }
	
	# cooldown = { years = standard_explore_history_cooldown_time }
	
	##desc is only shown in debug AI watch window
	# ai_will_do = {
		# add = {
			# value = 30
			# desc = "Base"
		# }
		# add = {
            # value = ai_greed
            # multiply = -0.25
            # desc = "ai_greed"
        # }
        # add = {
        	# value = ai_sociability
        	# multiply = -0.25
        	# desc = "ai_sociability"
        # }
		# if = {
			# limit = {
				# ai_energy < 0
			# }
			# add = {
				# add = ai_energy
				# desc = "ai_energy"
			# }
		# }
		# if = {
			# limit = { has_trait = gregarious }
			# add = {
				# value = -10
				# desc = "Is gregarious"
			# }
		# }
		# if = {
			# limit = { has_trait = shy }
			# add = {
				# value = 30
				# desc = "Is shy"
			# }
		# }
		# if = {
			# limit = { has_trait = reclusive }
			# add = {
				# value = 30
				# desc = "Is reclusive"
			# }
		# }
		# if = {
			# limit = {
				# short_term_gold >= explore_history_activity_cost
				# short_term_gold >= major_gold_value
			# }
			# add = {
				# value = 30
				# desc = "Got gold to burn"
			# }
		# }
		# if = {
			# limit = { has_trait = lifestyle_archivist }
			# add = {
				# value = 20
				# desc = "Is Archivist"
			# }
		# }
		# if = {
			# limit = {
				# has_royal_court = yes 
				# has_court_type = court_learning
				# }
			# add = {
				# value = 10
				# desc = "Learning court trait"
			# }
		# }
		# if = {
			# limit = { has_trait = diligent }
			# add = {
				# value = 30
				# desc = "Is Diligent"
			# }
		# }
		# if = {
			# limit = { has_trait = journaler }
			# add = {
				# value = 30
				# desc = "Is Journaler"
			# }
		# }
		# if = {
			# limit = { has_trait = calm }
			# add = {
				# value = 10
				# desc = "Is Calm"
			# }
		# }
		# if = {
			# limit = { has_trait = patient }
			# add = {
				# value = 10
				# desc = "Is Patient"
			# }
		# }
		# if = {
			# limit = { has_trait = impatient }
			# add = {
				# value = -10
				# desc = "Is Impatient"
			# }
		# }
		# if = {
			# limit = { has_trait = scholar }
			# add = {
				# value = 30
				# desc = "Is Scholar"
			# }
		# }
		##Stress
		# if = { # Low Stress
            # limit = {
				# stress >= lower_than_baseline_stress
				# NOT = { has_trait = impatient }
			# }
            # add = {
            	# value = 10
            	# desc = "lower_than_baseline_stress"
            # }
        # }
        # if = { # High Stress
        	# limit = {
				# stress >= higher_than_baseline_stress
				# NOT = { has_trait = impatient }
			# }
        	# add = {
        		# value = 10
        		# desc = "higher_than_baseline_stress"
        	# }
        # }
        # if = { # Very High Stress
        	# limit = {
				# stress >= high_stress
				# NOT = { has_trait = impatient }
			# }
        	# add = {
        		# value = 10
        		# desc = "high_stress"
        	# }
        # }
        # if = {
        	# limit = { ai_has_warlike_personality = yes }
        	# add = {
            	# value = -30
            	# desc = "Warlike"
            # }
        # }
        ##Economic Archetype
		# if = { # Too busy booming the economy
            # limit = {
                # OR = {
                    # ai_has_economical_boom_personality = yes
                    # has_character_flag = ai_boom
                # }
            # }
            # add = {
            	# value = -200
            	# desc = "Builder"
            # }
        # }
	# }
	
	###################
	##GUEST HANDLING
	###################

	# max_guests = 5
	
	# guest_invite_rules = {
		# rules = {
			##Misc landless.
			# 5 = activity_invite_rule_knights

			##MP 
			# 6 = activity_invite_mp
		# }
		# defaults = {
			# 1 = activity_invite_rule_close_family
			# 1 = activity_invite_spouses
		# }
	# }

	# can_be_activity_guest = {
		# is_adult = yes
		# is_healthy = yes
		# in_diplomatic_range = scope:host
		# is_sauron = no
		# is_nazgul = no
		# is_in_valinor = no
	# }

	# host_intents = {
		# intents = { reduce_stress_intent learn_intent befriend_attendee_intent }
		# default = learn_intent
	# }

	# guest_intents = {
		# intents = { reduce_stress_intent learn_intent befriend_attendee_intent }
		# default = learn_intent
	# }
	
	# guest_join_chance = {
		# base = 10
		# base_activity_modifier = yes

		##Scripted Modifiers
		# activity_guest_shared_ai_accept_modifier = yes 
		# activity_guest_explore_history_ai_accept_modifier = yes
	# }
	
	# travel_entourage_selection = {
		# weight = standard_travel_entourage_additions
		# max = 5
		# invite_rule_order = 1
	# }
	
	###################
	##OPTIONS
	###################

	# special_option_category = special_type

	# options = {
		##option example
		# special_type = {
			# explore_history_type_standard = {
				# default = yes
				# is_valid = {
					# religion = { is_in_family = rf_eruhini }
					# OR = {
						# lotr_has_numenorean_culture_trigger = yes
						# is_eldar = yes
					# }
				# }
			# }
			# explore_history_type_adunaic_propaganda = {
				# is_valid = { faith = { has_doctrine = tenet_adunaic_birthright } }
				# cost = {
					# gold = {
						# add = {
							# add = {
								# value = hunt_activity_base_cost #Base level
								# desc = hunt_type_falconry
							# }
							# if = {
								# limit = {
									# dynasty ?= {
										# has_dynasty_perk = law_legacy_1
									# }
								# }
								# subtract = {
									# value = 0
									# add = {
										# value = hunt_activity_base_cost
										# add = {
											# value = hunt_activity_base_cost
											# multiply = activity_cost_scale_by_era
											# subtract = hunt_activity_base_cost
										# }
									# }
									# multiply = law_legacy_cost_reduction_mult
									# desc = law_legacy_1_name
								# }
							# }
							# if = {
								# limit = {
									# has_character_flag = free_hunt
								# }
								# multiply = 0
							# }
						# }
					# }
				# }
			# }
		# }
	# }

	solo = yes
	color = { 0.253906 0.867188 0.105469 1 }
	on_spawn = {
		invite_character_to_activity = activity_owner
		accept_invitation_for_character = activity_owner

	}
	on_activate = {
		activity_owner = {
			trigger_event = {
				on_action = explore_history_setup # On-action starting the history exploration events
			}
		}
	}
}