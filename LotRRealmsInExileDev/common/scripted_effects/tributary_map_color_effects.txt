lotr_e_map_barony = {
	every_barony = {
		county = {
			prev = { set_color_from_title = prev }
		}
	}
}

## Map Legend
# My Realm (CUSTOM_TRIBUTARY_MAP_ME)
# My Tributary States (CUSTOM_TRIBUTARY_MAP_MY_TRIBUTARY_STATES)
# My Client States (CUSTOM_TRIBUTARY_MAP_MY_CLIENT_STATES)
# My Protectorates (CUSTOM_TRIBUTARY_MAP_MY_PROTECTORATES)
# My Suzerain (CUSTOM_TRIBUTARY_MAP_MY_SUZERAIN)
# My Protector (CUSTOM_TRIBUTARY_MAP_MY_PROTECTOR)
# Tributary States (CUSTOM_TRIBUTARY_MAP_ANY_TRIBUTARY_STATES)
# Client States (CUSTOM_TRIBUTARY_MAP_ANY_CLIENT_STATES)
# Protectorates (CUSTOM_TRIBUTARY_MAP_ANY_PROTECTORATES)
# Suzerains (CUSTOM_TRIBUTARY_MAP_ANY_SUZERAIN)
# Protectors (CUSTOM_TRIBUTARY_MAP_ANY_PROTECTOR)

lotr_e_tributary_map = {
	global_var:custom_map_tributary_target = {
		save_temporary_scope_as = target_character
	}
	every_county = {
		if = {
			# My Realm (CUSTOM_TRIBUTARY_MAP_ME)
			limit = {
				holder = {
					OR = {
						# is me
						this = scope:target_character

						# liege is me
						any_liege_or_above = { this = scope:target_character }
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_target } }
		}
		else_if = {
			# My Tributary States (CUSTOM_TRIBUTARY_MAP_MY_TRIBUTARY_STATES)

			limit = {
				holder = {
					OR = {
						# has a suzerain and suzerain is me
						AND = {
							exists = var:my_suzerain
							var:my_suzerain = scope:target_character
							exists = var:tributary_type
							var:tributary_type = flag:non_permanent_tributary
						}

						# liege has a suzerain and suzerain is me
						any_liege_or_above = {
							exists = var:my_suzerain
							var:my_suzerain = scope:target_character
							exists = var:tributary_type
							var:tributary_type = flag:non_permanent_tributary
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_target_tributary_state } }
		}
		else_if = {
			# My Client States (CUSTOM_TRIBUTARY_MAP_MY_CLIENT_STATES)

			limit = {
				holder = {
					OR = {
						# has a suzerain and suzerain is me
						AND = {
							exists = var:my_suzerain
							var:my_suzerain = scope:target_character
							#exists = var:overlord_suzerain
							exists = var:tributary_type
							var:tributary_type = flag:permanent_tributary
						}

						# liege has a suzerain and suzerain is me
						any_liege_or_above = {
							exists = var:my_suzerain
							var:my_suzerain = scope:target_character
							#exists = var:overlord_suzerain
							exists = var:tributary_type
							var:tributary_type = flag:permanent_tributary
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_target_client_state } }
		}
		else_if = {
			# My Protectorates (CUSTOM_TRIBUTARY_MAP_MY_PROTECTORATES)

			limit = {
				holder = {
					OR = {
						# has a suzerain and suzerain is me
						AND = {
							exists = var:my_suzerain
							var:my_suzerain = scope:target_character
							#exists = var:overlord_protector
							exists = var:tributary_type
							var:tributary_type = flag:tributary_protectorate
						}

						# liege has a suzerain and suzerain is me
						any_liege_or_above = {
							exists = var:my_suzerain
							var:my_suzerain = scope:target_character
							#exists = var:overlord_protector
							exists = var:tributary_type
							var:tributary_type = flag:tributary_protectorate
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_target_protectorate } }
		}
		else_if = {
			# My Suzerain (CUSTOM_TRIBUTARY_MAP_MY_SUZERAIN)

			limit = {
				holder = {
					OR = {
						AND = {
							has_variable_list = permanent_tributaries
							is_target_in_variable_list = { name = permanent_tributaries target = scope:target_character }
							scope:target_character = {
								exists = var:tributary_type
								NOT = { var:tributary_type = flag:tributary_protectorate }
							}
						}
						AND = {
							has_variable_list = non_permanent_tributaries
							is_target_in_variable_list = { name = non_permanent_tributaries target = scope:target_character }
							scope:target_character = {
								exists = var:tributary_type
								NOT = { var:tributary_type = flag:tributary_protectorate }
							}
						}
						any_liege_or_above = {
							OR = {
								AND = {
									has_variable_list = permanent_tributaries
									is_target_in_variable_list = { name = permanent_tributaries target = scope:target_character }
									scope:target_character = {
										exists = var:tributary_type
										NOT = { var:tributary_type = flag:tributary_protectorate }
									}
								}
								AND = {
									has_variable_list = non_permanent_tributaries
									is_target_in_variable_list = { name = non_permanent_tributaries target = scope:target_character }
									scope:target_character = {
										exists = var:tributary_type
										NOT = { var:tributary_type = flag:tributary_protectorate }
									}
								}
							}
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_target_suzerain } }
		}
		else_if = {
			# My Protector (CUSTOM_TRIBUTARY_MAP_MY_PROTECTOR)

			limit = {
				holder = {
					OR = {
						AND = {
							has_variable_list = permanent_tributaries
							is_target_in_variable_list = { name = permanent_tributaries target = scope:target_character }
							scope:target_character = {
								exists = var:tributary_type
								var:tributary_type = flag:tributary_protectorate
							}
						}
						any_liege_or_above = {
							OR = {
								AND = {
									has_variable_list = permanent_tributaries
									is_target_in_variable_list = { name = permanent_tributaries target = scope:target_character }
									scope:target_character = {
										exists = var:tributary_type
										var:tributary_type = flag:tributary_protectorate
									}
								}
							}
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_target_protector } }
		}
		else_if = {
			# Tributary States (CUSTOM_TRIBUTARY_MAP_ANY_TRIBUTARY_STATES)

			limit = {
				holder = {
					OR = {
						# has a suzerain
						AND = {
							exists = var:my_suzerain
							NOT = { var:my_suzerain = scope:target_character }
							exists = var:tributary_type
							var:tributary_type = flag:non_permanent_tributary
						}

						# liege has a suzerain and suzerain is me
						any_liege_or_above = {
							exists = var:my_suzerain
							NOT = { var:my_suzerain = scope:target_character }
							exists = var:tributary_type
							var:tributary_type = flag:non_permanent_tributary
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_tributary_state } }
		}
		else_if = {
			# Client States (CUSTOM_TRIBUTARY_MAP_ANY_CLIENT_STATES)

			limit = {
				holder = {
					OR = {
						# has a suzerain 
						AND = {
							exists = var:my_suzerain
							NOT = { var:my_suzerain = scope:target_character }
							#exists = var:overlord_suzerain
							exists = var:tributary_type
							var:tributary_type = flag:permanent_tributary
						}

						# liege has a suzerain and suzerain is me
						any_liege_or_above = {
							exists = var:my_suzerain
							NOT = { var:my_suzerain = scope:target_character }
							#exists = var:overlord_suzerain
							exists = var:tributary_type
							var:tributary_type = flag:permanent_tributary
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_client_state } }
		}
		else_if = {
			# Protectorates (CUSTOM_TRIBUTARY_MAP_ANY_PROTECTORATES)

			limit = {
				holder = {
					OR = {
						# has a suzerain and suzerain is me
						AND = {
							exists = var:my_suzerain
							NOT = { var:my_suzerain = scope:target_character }
							#exists = var:overlord_protector
							exists = var:tributary_type
							var:tributary_type = flag:tributary_protectorate
						}

						# liege has a suzerain and suzerain is me
						any_liege_or_above = {
							exists = var:my_suzerain
							NOT = { var:my_suzerain = scope:target_character }
							#exists = var:overlord_protector
							exists = var:tributary_type
							var:tributary_type = flag:tributary_protectorate
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_protectorate } }
		}
		else_if = {
			# Suzerains (CUSTOM_TRIBUTARY_MAP_ANY_SUZERAIN)

			limit = {
				holder = {
					OR = {
						AND = {
							has_variable_list = all_tributaries
							NOT = { is_target_in_variable_list = { name = all_tributaries target = scope:target_character } }
							any_in_list = {
								variable = all_tributaries
								exists = var:overlord_type
								var:overlord_type = flag:suzerain
							}
						}
						any_liege_or_above = {
							AND = {
								has_variable_list = all_tributaries
								NOT = { is_target_in_variable_list = { name = all_tributaries target = scope:target_character } }
								any_in_list = {
									variable = all_tributaries
									exists = var:overlord_type
									var:overlord_type = flag:suzerain
								}
							}
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_suzerain } }
		}
		else_if = {
			# Protectors (CUSTOM_TRIBUTARY_MAP_ANY_PROTECTOR)

			limit = {
				holder = {
					OR = {
						AND = {
							has_variable_list = all_tributaries
							NOT = { is_target_in_variable_list = { name = all_tributaries target = scope:target_character } }
							any_in_list = {
								variable = all_tributaries
								exists = var:overlord_type
								var:overlord_type = flag:protector
							}
						}
						any_liege_or_above = {
							AND = {
								has_variable_list = all_tributaries
								NOT = { is_target_in_variable_list = { name = all_tributaries target = scope:target_character } }
								any_in_list = {
									variable = all_tributaries
									exists = var:overlord_type
									var:overlord_type = flag:protector
								}
							}
						}
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_protector } }
		}
		else {
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_base } }
		}
	}
}

lotr_e_alignment_map = {
	global_var:custom_map_tributary_target = {
		save_temporary_scope_as = target_character
	}
	every_county = {
		if = {
			# Good
			limit = {
				holder.religion = {
					OR = { 
						is_in_family = rf_freepeoples
						is_in_family = rf_eruhini
					}
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_alignment_map_good } }
		}
		else_if = {
			# Good Leaning
			limit = {
				holder.faith = {
					has_doctrine = doctrine_echoes_of_the_ainur
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_alignment_map_goodish } }
		}
		else_if = {
			# Neutral
			limit = {
				holder.faith = {
					has_doctrine = doctrine_a_people_apart
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_alignment_map_neutral } }
		}
		else_if = {
			# Evilish
			limit = {
				holder.faith = {
					has_doctrine = doctrine_dominion_of_the_dark
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_alignment_map_evilish } }
		}
		else_if = {
			# Evil
			limit = {
				holder.religion = {
					is_in_family = rf_forcesofevil
				}
			}
			every_county_province = { barony = { set_color_from_title = title:d_alignment_map_evil } }
		}
		else {
			every_county_province = { barony = { set_color_from_title = title:d_tributary_map_base } }
		}
	}
}