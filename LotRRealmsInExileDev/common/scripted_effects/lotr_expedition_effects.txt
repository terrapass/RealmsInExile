title_change_effect = {
	set_holding_type = castle_holding

	create_title_and_vassal_change = {
		type = created
		save_scope_as = change
		add_claim_on_loss = no
	}

	county = {
		set_county_culture = scope:$RULER$.culture
		set_county_faith = scope:$RULER$.faith
			
		change_title_holder = {
			holder = scope:$RULER$
			change = scope:change
		}
	}
	if = {
		limit = { 
			NOT = { scope:$RULER$ ?= scope:host } 
		}
		scope:$RULER$ = { becomes_independent = { change = scope:change } }
	}
	
	resolve_title_and_vassal_change = scope:change
		
	county = { generate_coa = yes }
	county = { scope:$RULER$ = { set_realm_capital = prev } }

	# Give titles away if moving realm
	if = {
		limit = {
			scope:activity = {
				has_activity_option = { category = special_type option = expedition_type_standard }
			}
		}
		scope:host = {
			every_held_title = {
				limit = {
					NOT = { this = scope:activity.activity_location.county }
				}
				add_to_list = transfered_titles
			}
		}
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = change
			add_claim_on_loss = yes
		}

		every_in_list = {
			list = transfered_titles
			change_title_holder = {
				holder = scope:opportunistic_dwarf
				change = scope:change
			}
		} 
		resolve_title_and_vassal_change = scope:change
	}

	# spawn building at new area
	if = {
		limit = { 
			scope:activity = {
				has_activity_option = { category = expedition_option_gold_investment option = expedition_gold_investment_low }
			}
			# add_building = mushroom farm | lvl 3
		}
	}
	else_if = {
		limit = { 
			scope:activity = {
				has_activity_option = { category = expedition_option_gold_investment option = expedition_gold_investment_medium }
			}
			# add_building = mushroom farm | lvl 6
			# add_building = military buiding| lvl 3
		}
	}
	else = {
		if = {
			limit = { 
				scope:activity = {
					has_activity_option = { category = expedition_option_gold_investment option = expedition_gold_investment_high }
				}
			}
			# add_building = mushroom farm | lvl 5
			# add_building = military buiding| lvl 5
			county.title_province = { add_building = castle_02 }
		}
	}
}