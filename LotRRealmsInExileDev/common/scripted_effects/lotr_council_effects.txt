setup_dorwinion_council_members = {
    remove_global_variable = dorinion_council_member_7
    remove_global_variable = dorinion_council_member_6
    remove_global_variable = dorinion_council_member_5
    remove_global_variable = dorinion_council_member_4
    remove_global_variable = dorinion_council_member_3
    remove_global_variable = dorinion_council_member_2
    remove_global_variable = dorinion_council_member_1


    title:k_dorwinion = {
        every_in_de_jure_hierarchy = {
            limit = {
                exists = holder
                NOT = { holder = prev.holder }
                holder.top_liege = title:k_dorwinion.holder
                OR = {
                    tier = tier_county
                    tier = tier_duchy
                }
            }
            holder = { add_to_list = voters_in_dorwinion } 
        }
        set_global_variable = {
            name = dorinion_council_member_4
            value = holder
        }
    }

    ordered_in_list = {
        list = voters_in_dorwinion
        max = 7
        order_by = {
            add = monthly_character_income
            add = average_development_in_holdings
            if = {
                limit = { dynasty ?= { has_dynasty_modifier = master_merchants } }
                add = stewardship.div2
            }
            if = {
                limit = { dynasty ?= { has_dynasty_modifier = winelords } }
                add = number_of_held_holdings
            }
        }
        
        if = {
            limit = { has_global_variable = dorinion_council_member_1 }
            set_global_variable = {
                name = dorinion_council_member_7
                value = this
            }
        }
        else_if = {
            limit = { has_global_variable = dorinion_council_member_6 }
            set_global_variable = {
                name = dorinion_council_member_1
                value = this
            }
        }
        else_if = {
            limit = { has_global_variable = dorinion_council_member_2 }
            set_global_variable = {
                name = dorinion_council_member_6
                value = this
            }
        }
        else_if = {
            limit = { has_global_variable = dorinion_council_member_5 }
            set_global_variable = {
                name = dorinion_council_member_2
                value = this
            }
        }
        else_if = {
            limit = { has_global_variable = dorinion_council_member_3 }
            set_global_variable = {
                name = dorinion_council_member_5
                value = this
            }
        }
        else = {
            set_global_variable = {
                name = dorinion_council_member_3
                value = this
            }
        }
    }
}

fire_events_for_dorwinion_council_members = {
    title:k_dorwinion.holder = {
        clear_variable_list = positive_vote
        clear_variable_list = negative_vote
        set_variable = vote_is_being_held
    }

    every_lotr_council_member = {
        limit = { target_is_liege_or_above = title:k_dorwinion.holder }
        trigger_event = { id = $EVENT_ID$ days = { 1 5 } } # White Peace
    }

    title:k_dorwinion.holder = { trigger_event = { id = council_events.9998 days = 7 } }
}

fire_events_for_de_jure_vassals = {
    $TITLE$.holder = {
        clear_variable_list = positive_vote
        clear_variable_list = negative_vote
        set_variable = vote_is_being_held
    }
    $TITLE$ = {
        every_in_de_jure_hierarchy = {
            limit = {
                exists = holder
                tier = tier_county
                NOT = { holder = prev.holder }
            }
            holder = { add_to_list = targeted_vassals }
        }
    }

    every_in_list = {
        list = targeted_vassals
        limit = { NOT = { this = root } }
        trigger_event = { id = $EVENT_ID$ days = { 1 5 } }
    }

    $TITLE$.holder = {
        add_to_variable_list = {
            name = positive_vote
            target = root
        }
    }
}