show_gui_button = {
    is_shown = {
        OR = {
            top_liege.primary_title = title:k_dorwinion
            primary_title = title:k_dorwinion
        }
    }
}

show_char_in_first_window = {
    is_valid = {
        root = global_var:dorinion_council_member_1
    }
}

show_char_in_second_window = {
    is_valid = {
        root = global_var:dorinion_council_member_2
    }
}

show_char_in_third_window = {
    is_valid = {
        root = global_var:dorinion_council_member_3
    }
}

show_char_in_fourth_window = {
    is_valid = {
        root = global_var:dorinion_council_member_4
    }
}

show_char_in_fith_window = {
    is_valid = {
        root = global_var:dorinion_council_member_5
    }
}

show_char_in_sixth_window = {
    is_valid = {
        root = global_var:dorinion_council_member_6
    }
}

show_char_in_seventh_window = {
    is_valid = {
        root = global_var:dorinion_council_member_7
    }
}

show_char_ruling_window = {
    is_valid = {
        always = no
    }
}

##########################
### Policy button GUIs ###
##########################

### White Peace sGUIs ###
button_sign_white_peace = {
    is_shown = {
        title:k_dorwinion.holder = { # Realm-Master is at war
            is_at_war = yes
        }
    }

    is_valid = {
        custom_tooltip = {
            text = BUTTON_sign_white_peace_cooldown
            NOT = { title:k_dorwinion.holder = { has_variable = unavailable_proposal_dorwinion } }
        }
        custom_tooltip = {
            text = BUTTON_sign_white_peace_no_title_selected.tt
            has_variable = selected_war
        }
        custom_tooltip = {
            text = BUTTON_sign_white_peace_no_title_selected.tt
            has_variable = selected_war
        }
        custom_tooltip = {
            text = BUTTON_proposal_is_being_voted_on
            NOT = { title:k_dorwinion.holder = { has_variable = vote_is_being_held } }
        }
        custom_tooltip = {
            text = BUTTON_sign_white_peace_disabled_tt
            NOT = { root = title:k_dorwinion.holder }
        }
        trigger_if = {
            limit = {
                title:k_dorwinion.holder = { any_character_war = { primary_defender = root  } }
            }
            custom_tooltip = {
                text = BUTTON_sign_white_peace_offer_available
                NOT = {
                    title:k_dorwinion.holder = {
                        any_character_war = {
                            trigger_if = {
                                limit = { root = { has_variable = selected_war } }
                                this = root.var:selected_war
                            }
                            primary_defender = title:k_dorwinion.holder 
                            defender_war_score < 30
                        }
                    }
                }
            }
        }
        trigger_else = {
            custom_tooltip = {
                text = BUTTON_sign_white_peace_offer_available
                NOT = {
                    title:k_dorwinion.holder = {
                        any_character_war = {
                            trigger_if = {
                                limit = { root = { has_variable = selected_war } }
                                this = root.var:selected_war
                            }
                            primary_attacker = title:k_dorwinion.holder 
                            attacker_war_score < 30
                        }
                    }
                }
            }
        }
    }

    effect = {
        title:k_dorwinion.holder = {
            set_variable = {
                name = proposee
                value = root
            }
        }
        if = {
            limit = { NOT = { root = title:k_dorwinion.holder } }
            custom_tooltip = BUTTON_sign_white_peace_enabled_tt
        }
        fire_events_for_de_jure_vassals = { EVENT_ID = council_events.0001 TITLE = title:k_dorwinion }
        title:k_dorwinion.holder = {
            trigger_event = { id = council_events.0001 days = { 1 5 } }
            set_variable = {
                name = unavailable_proposal_dorwinion
                years = 2
            }
        }

    }
}

set_selected_war_as_variable = {
    saved_scopes = {
        player_scope
    }
    effect = {
        scope:player_scope = {
            if = {
                limit = { has_variable = selected_war }
                remove_variable = selected_war
            }
            set_variable = {
                name = selected_war
                value = root
            }
        }
    }
}

clear_selected_war_as_variable = {
    effect = { remove_variable = selected_war }
}

### War Declaration sGUIs ##

button_war_declaration = {
    is_shown = {
        any_ruler = {
            NOT =  { target_is_vassal_or_below = title:k_dorwinion.holder }
            NOT = { this = title:k_dorwinion.holder }
            NOT = { is_allied_to = title:k_dorwinion.holder }
            in_diplomatic_range = title:k_dorwinion.holder
            title:k_dorwinion.holder = { # Realm-Master is at war
                OR = {
                    has_cb_on = {
                        target = prev
                        cb = de_jure_cb
                    }
                    has_cb_on = {
                        target = prev
                        cb = individual_county_de_jure_cb
                    }
                    has_cb_on = {
                        target = prev
                        cb = individual_duchy_de_jure_cb
                    }
                }
            }
        }
    }

    is_valid = {
        custom_tooltip = {
            text = BUTTON_vote_for_war_select_title_tt
            has_variable = title_selected
        }
    }

    effect = {

    }
}

set_selected_title_as_variable = {
    saved_scopes = {
        player_scope
    }
    effect = {
        scope:player_scope = {
            if = {
                limit = { has_variable = selected_title }
                remove_variable = selected_title
            }
            set_variable = {
                name = selected_title
                value = root
            }
        }
    }
}

clear_selected_title_as_variable = {
    effect = { remove_variable = selected_war }
}

show_no_policies_text = {
    is_shown = {
        NOT = {
            title:k_dorwinion.holder = { has_variable_list = active_wars }
            title:k_dorwinion.holder = { has_variable_list = target_chars }
        }
    }
}

show_progress_bar = {
    is_shown = {
        title:k_dorwinion.holder = { has_variable = vote_is_being_held }
    }
}

set_starting_lists_on_character = {
    effect = {
        clear_variable_list = active_wars
        clear_variable_list = target_chars
        
        # WHITE PEACE
        every_character_war = {
            save_temporary_scope_as = war
            root = {
                add_to_variable_list = {
                    name = active_wars
                    target = scope:war
                }
            }
        }

        # DECLARE WAR
        every_ruler = {
            limit = {
                NOT =  { target_is_vassal_or_below = title:k_dorwinion.holder }
                NOT = { this = title:k_dorwinion.holder }
                NOT = { is_allied_to = title:k_dorwinion.holder }
                in_diplomatic_range = title:k_dorwinion.holder
                NOT = { this = character:k_wastelands_holder }
                title:k_dorwinion.holder = { # Realm-Master is at war
                    OR = {
                        has_cb_on = {
                            target = prev
                            cb = de_jure_cb
                        }
                        has_cb_on = {
                            target = prev
                            cb = individual_county_de_jure_cb
                        }
                        has_cb_on = {
                            target = prev
                            cb = individual_duchy_de_jure_cb
                        }
                        has_cb_on = {
                            target = prev
                            cb = claim_cb
                        }
                        has_cb_on = {
                            target = prev
                            cb = ducal_conquest_cb
                        }
                        has_cb_on = {
                            target = prev
                            cb = county_conquest_cb
                        }
                        has_cb_on = {
                            target = prev
                            cb = duchy_conquest_cb
                        }
                        has_cb_on = {
                            target = prev
                            cb = minor_religious_war
                        }
                        has_cb_on = {
                            target = prev
                            cb = religious_war
                        }
                        has_cb_on = {
                            target = prev
                            cb = major_religious_war
                        }
                        has_cb_on = {
                            target = prev
                            cb = vassalization_cb
                        }
                    }
                }
            }
            save_temporary_scope_as = char
            root = {
                add_to_variable_list = {
                    name = target_chars
                    target = scope:char
                }
            }
        }
    }
}