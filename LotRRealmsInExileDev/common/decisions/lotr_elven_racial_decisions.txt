### Elven Racial Mechanics ###

decision_try_for_elven_child = {
	title = decision_try_for_elven_child
	picture = "gfx/interface/illustrations/decisions/decision_elf_love.dds"
	major = yes
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	selection_tooltip = decision_try_for_elven_child_tooltip
	desc = decision_try_for_elven_child_desc
	confirm_text = decision_try_for_elven_child_confirm
	
	is_shown = {
		is_elf = yes
		trigger_if = {
			limit = { is_married = yes }
			primary_spouse = { is_elf = yes }
			sex_opposite_of = primary_spouse
			NOR = { 
				has_character_flag = elf_childbirth_ongoing
				has_character_modifier = elf_child_limit_modifier
				primary_spouse = { has_character_modifier = elf_child_limit_modifier }
			}
			OR = {
				is_ai = no
				AND = {
					is_ai = yes
					primary_spouse = { is_ai = yes }
				}
			}
		}
		trigger_else = {
			always = no
		}
	}
	
	is_valid = {
		trigger_if = {
			limit = { is_married = yes }
			has_relation_soulmate = primary_spouse
			stress_level < 1
			is_at_war = no		
			NOR = { 
				has_character_modifier = elf_childraising_modifier
				primary_spouse = { has_character_modifier = elf_childraising_modifier }
			}
		}
		trigger_else = {
			always = no
		}
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}
	
	effect = {
		trigger_event = elven_racial.0001
		add_character_flag = elf_childbirth_ongoing
		primary_spouse = { add_character_flag = elf_childbirth_ongoing }
	}
	
}

decision_sail_to_valinor = {
	title = decision_sail_to_valinor
	picture = "gfx/interface/illustrations/decisions/decision_mithlond_01.dds"
	
	sort_order = 1000

	ai_goal = no
	ai_check_interval = 60	
	ai_potential = {
		always = no
	}
	ai_will_do = { #Finesse this - JS
		base = 0
	}
	
	selection_tooltip = decision_sail_to_valinor_tooltip
	desc = decision_sail_to_valinor_desc
	confirm_text = decision_sail_to_valinor_confirm
	
	is_shown = {
		is_elf = yes
		NOT = { 
			has_trait = sailed_west
		}
		is_ai = no
	}
	
	is_valid = {
		is_at_war = no		
		NOT = { 
			has_character_modifier = elf_childraising_modifier
		}
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}
	
	effect = {
		depose = yes
		every_claim = {
			root = { remove_claim = prev }
		}
		add_trait = sailed_west
		custom_tooltip = {
			text = sail_to_valinor
			set_employer = title:k_tirion.holder
		}
	}
	
}

##################################################
# Establish the high kingdom of Eryn Lasgalen
# by Fredsch
##################################################
decision_establish_high_kingdom_of_eryn_lasgalen = {
	picture = "gfx/interface/illustrations/decisions/decision_eryn_lasgalen.dds"
	title = decision_establish_high_kingdom_of_eryn_lasgalen
	desc = decision_establish_high_kingdom_of_eryn_lasgalen_desc	
	selection_tooltip = decision_establish_high_kingdom_of_eryn_lasgalen_tooltip
	confirm_text = decision_establish_high_kingdom_of_eryn_lasgalen_confirm
	major = yes

	# Shown checks
	is_shown = {
		is_elf = yes
		culture = culture:lasgalendrim

		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_establish_high_kingdom_of_eryn_lasgalen
			}
		}
	}

	# Valid checks
	is_valid = {
		is_at_war = no
		is_independent_ruler = yes
		prestige_level >= max_prestige_level
		completely_controls_region = middleearth_west_rhovanion_mirkwood
		has_title = title:k_lasgalen
		custom_description = {
			text = decision_establish_high_kingdom_of_eryn_lasgalen.amon_lanc_is_lasgalendrim
			title:c_amon_lanc.culture = culture:lasgalendrim
		}
		title:c_amon_lanc = { 
			title_province = {
				has_building = wonder_amon_lanc_03
			}
		}
	}

	# Effect
	effect = {
		get_title = title:e_greenwood
		custom_tooltip = decision_establish_high_kingdom_of_eryn_lasgalen.greenwood_renamed_eryn_lasgalen
		title:e_greenwood = { set_title_name = e_eryn_lasgalen }
		dynasty_legacy_of_oropher_effects = yes

		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_establish_high_kingdom_of_eryn_lasgalen
		}

		if = {
			limit = { # Major News
				NOT = { has_game_rule = no_news }
			}
			every_player = { #Global News Announcement
				trigger_event = news_event.0017
			}
		}
	}

	# Cost
	cost = {
		prestige = 5000
	}

	# AI values
	ai_check_interval = 12

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

##################################################
# Claim Amon Lanc for Laurelindòrenan
# by Fredsch
##################################################
claim_amon_lanc_for_laurelindorenan = {
	picture = "gfx/interface/illustrations/decisions/decision_eryn_lasgalen.dds"
	title = claim_amon_lanc_for_laurelindorenan
	desc = claim_amon_lanc_for_laurelindorenan_desc	
	selection_tooltip = claim_amon_lanc_for_laurelindorenan_tooltip
	confirm_text = claim_amon_lanc_for_laurelindorenan_confirm
	major = yes

	# Shown checks
	is_shown = {
		is_elf = yes
		culture = culture:galadhrim

		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:claim_amon_lanc_for_laurelindorenan
			}
		}
	}

	# Valid checks
	is_valid = {
		is_at_war = no
		is_independent_ruler = yes
		prestige_level >= max_prestige_level
		has_title = title:k_lothlorien
		completely_controls = title:d_amon_lanc
		completely_controls = title:d_gwath_anglennol
		completely_controls = title:d_taur_e_ndaedlos
		completely_controls = title:d_drownholt
		custom_description = {
			text = claim_amon_lanc_for_laurelindorenan.amon_lanc_is_galadhrim
			title:c_amon_lanc.culture = culture:galadhrim
		}
		title:c_amon_lanc = { 
			title_province = {
				has_building = wonder_amon_lanc_03
			}
		}
	}

	# Effect
	effect = {
		get_title = title:e_laurelindorenan
		title:k_amon_lanc = { set_de_jure_liege_title = title:e_laurelindorenan }
		title:d_drownholt = { set_de_jure_liege_title = title:k_lothlorien }
		custom_tooltip = claim_amon_lanc_for_laurelindorenan.amon_lanc_renamed_east_lorien
		title:k_amon_lanc = { set_title_name = cn_east_lorien }
		if = {
			limit = { is_male = yes }
			give_nickname = nick_lord_of_light
		} 
		else = {
			give_nickname = nick_lady_of_light
		}
		every_player = {
			show_as_tooltip = {
				dynasty_light_of_the_forest = yes
			}
		}

		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:claim_amon_lanc_for_laurelindorenan
		}
	}

	# Cost
	cost = {
		prestige = 5000
	}

	# AI values
	ai_check_interval = 12

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}
