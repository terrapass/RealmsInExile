### Umbar Decisions ###

decision_harnen_kingdom = {
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {				
					culture = { 
						OR = {	
							has_cultural_pillar = heritage_northern_adunaic
							has_cultural_pillar = heritage_southern_adunaic
							has_cultural_pillar = heritage_bellakari
						}
					}
				}
				desc = decision_harnen_kingdom_adunaic
			}
			desc = decision_harnen_kingdom
		}
		
	}
	picture = "gfx/interface/illustrations/decisions/decision_near_harad_01.dds"
	major = yes
	ai_check_interval = 3
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	selection_tooltip = decision_harnen_kingdom_tooltip
	desc = decision_harnen_kingdom_desc
	confirm_text = decision_harnen_kingdom_confirm
	
	is_shown = {
		current_year >= 4200 # Must not exist
		is_ruler = yes
		is_landed = yes
		AND = {
			OR = {
				culture = { 
					OR = {	
						has_cultural_pillar = heritage_northern_adunaic
						has_cultural_pillar = heritage_southern_adunaic
						has_cultural_pillar = heritage_dunedain
					}
				}
				AND = {
					lotr_has_numenorean_culture_trigger = yes
					has_primary_title = title:e_numenor_in_exile
				}
			}
			OR = {
				completely_controls = title:c_mirlond
				completely_controls = title:c_ramlond
				completely_controls = title:c_umbar
			}
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:harnen_kingdom_decision
			}
		}
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
	
	is_valid = {
		# Juke note: The way its set up both a vassal king or the top liege emperor can use it at the same time. Bit weird, but not a big issue - We shouldnt disallow, say, a vassal harondorim campaign from using this
		completely_controls_region = custom_harnendor
		prestige_level >= high_prestige_level
	}
	
	effect = {
		create_title_and_vassal_change = {
			type = created
			save_scope_as = change
			add_claim_on_loss = no
		}
		title:k_mirlond = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		title:d_forethir = { set_de_jure_liege_title = title:k_mirlond }
		title:d_ramlond = { set_de_jure_liege_title = title:k_mirlond }
		title:d_doriant = { set_de_jure_liege_title = title:k_mirlond }
		title:k_mirlond = { change_development_level = 2 }
		
		resolve_title_and_vassal_change = scope:change
		
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:harnen_kingdom_decision
		}
		
		### Add it to the proper dejure Empire ###
		if = {
			limit = {
				primary_title = {
					OR = {
						this = title:e_gondor_steward
						this = title:e_gondor
						this = title:e_castamir
						this = title:e_umbar
						this = title:e_numenor_in_exile
						this = title:e_numenor_colonies
						AND = {
							this = title:e_reunitedkingdom
							is_target_in_global_variable_list = {
								name = unavailable_unique_decisions
								target = flag:decision_solidify_reunited_kingdom
							}
						}
					}
				}
			}
			title:k_mirlond = {
				set_de_jure_liege_title = root.primary_title
			}
		}
		else_if = {
			limit = {
				exists = top_liege
				top_liege.primary_title = {
					OR = {
						this = title:e_gondor_steward
						this = title:e_gondor
						this = title:e_castamir
						this = title:e_umbar
						this = title:e_numenor_in_exile
						this = title:e_numenor_colonies
						AND = {
							this = title:e_reunitedkingdom
							is_target_in_global_variable_list = {
								name = unavailable_unique_decisions
								target = flag:decision_solidify_reunited_kingdom
							}
						}
					}
				}
			}
			title:k_mirlond = { set_de_jure_liege_title = root.top_liege.primary_title }
		}
		else_if = {
			limit = {
				culture = { has_cultural_pillar = heritage_dunedain }
			}
			title:k_mirlond = {
				set_de_jure_liege_title = title:k_harondor.empire
			}
		}
		else = {
			title:k_mirlond = {
				set_de_jure_liege_title = title:k_umbar.empire
			}
		}
		
		
		### Juke note: old code, bad
#		if = {
#			limit = {
#				OR = {
#					mirlond_de_jure_liege_title = { NEW_LIEGE = e_gondor_steward }
#					primary_title = title:e_gondor_steward
#					top_liege.primary_title ?= title:e_gondor_steward
#				}
#			}
#			title:k_mirlond = { set_de_jure_liege_title = title:e_gondor_steward }
#		}
#		else_if = {
#			limit = {
#				mirlond_de_jure_liege_title = { NEW_LIEGE = e_gondor }
#					primary_title = title:e_gondor
#					top_liege.primary_title ?= title:e_gondor
#			}
#			title:k_mirlond = {
#				set_de_jure_liege_title = title:e_gondor
#			}
#		}
#		else_if = {
#			limit = {
#				OR = {
#					primary_title = {
#						OR = {
#							de_jure_liege = title:e_numenor_colonies
#							de_jure_liege.de_jure_liege = title:e_numenor_colonies
#							de_jure_liege.de_jure_liege.de_jure_liege = title:e_numenor_colonies
#						}
#					}
#					primary_title = title:e_numenor_colonies
#				}
#			}
#			title:k_mirlond = {
#				set_de_jure_liege_title = title:e_numenor_colonies
#			}
#		}
#		else_if = {
#			limit = {
#				OR = {
#					primary_title = {
#						OR = {
#							de_jure_liege = title:e_castamir
#							de_jure_liege.de_jure_liege = title:e_castamir
#							de_jure_liege.de_jure_liege.de_jure_liege = title:e_castamir
#						}
#					}
#					primary_title = title:e_castamir
#				}
#			}
#			title:k_mirlond = {
#				set_de_jure_liege_title = title:e_castamir
#			}
#		}
#		else_if = {
#			limit = {
#				OR = {
#					primary_title = {
#						OR = {
#							de_jure_liege = title:e_numenor_in_exile
#							de_jure_liege.de_jure_liege = title:e_numenor_in_exile
#							de_jure_liege.de_jure_liege.de_jure_liege = title:e_numenor_in_exile
#						}
#					}
#					primary_title = title:e_numenor_in_exile
#				}
#			}
#			title:k_mirlond = {
#				set_de_jure_liege_title = title:e_numenor_in_exile
#			}
#		}
#		else_if = {
#			limit = {
#				OR = {
#					primary_title = {
#						OR = {
#							de_jure_liege = title:e_reunitedkingdom
#							de_jure_liege.de_jure_liege = title:e_reunitedkingdom
#							de_jure_liege.de_jure_liege.de_jure_liege = title:e_reunitedkingdom
#						}
#					}
#					primary_title = title:e_reunitedkingdom
#				}
#				is_target_in_global_variable_list = {
#					name = unavailable_unique_decisions
#					target = flag:decision_solidify_reunited_kingdom
#				}
#			}
#			title:k_mirlond = {
#				set_de_jure_liege_title = title:e_reunitedkingdom
#			}
#		}
#		else_if = {
#			title:k_mirlond = {
#				set_de_jure_liege_title = title:e_umbar
#			}	
#		}
		custom_tooltip = harnen_kingdom_decision
	}
}

decision_castamir_claim = {
	title = decision_castamir_claim
	picture = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	major = yes
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
		modifier = { # AI will not attempt unless Gondor is weaker
			factor = 0
			exists = title:e_gondor.holder
			root.total_strength < title:e_gondor.holder.total_strength
		}
		modifier = {
			factor = 0
			exists = title:e_gondor_steward.holder
			root.total_strength < title:e_gondor_steward.holder.total_strength
		}
	}

	selection_tooltip = decision_castamir_claim_tooltip
	desc = decision_castamir_claim_desc
	confirm_text = decision_castamir_claim_confirm

	is_shown = {
		current_year >= 5481 # Castamiri go to Umbar
		is_ruler = yes
		is_landed = yes
		dynasty = dynasty:dynasty_kamal
		has_title = title:k_umbar
		OR = {
			exists = title:e_gondor
			exists = title:e_gondor_steward
		}
		NOR = {	#juke note: we want to account for gondor potentially being held by a castamiri already
			AND = {
				exists = title:e_gondor.holder
				title:e_gondor.holder = {
					dynasty = dynasty:dynasty_kamal
				}
			}
			AND = {
				exists = title:e_gondor_steward.holder
				title:e_gondor_steward.holder = {
					dynasty = dynasty:dynasty_kamal
				}
			}
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_castamir_claim
			}
		}
	}
	cooldown = {
		years = 30
	}

	is_valid = {
		custom_tooltip = {
			text = decision_castamir_claim_already_pressed_tooltip
			NOT = { has_character_flag = pressed_castamiri_claim }
		}
		NOT = { has_character_modifier = castamiri_claim_failed }
		faith.religion = religion:adunai_religion #Juke note: If they go corsair they cant press
		is_independent_ruler = yes
		dynasty = dynasty:dynasty_kamal
		completely_controls = title:k_umbar
		prestige_level >= very_high_prestige_level
		has_title = title:e_umbar
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
		NOR = {
			AND = {
				exists = title:e_gondor_steward.holder
				has_truce = title:e_gondor_steward.holder
			}
			AND = {	
				exists = title:e_gondor.holder
				has_truce = title:e_gondor.holder
			}			
		}
		custom_tooltip = {
			text = decision_castamir_claim_recently_failed.tt
			NOT = {
				dynasty:dynasty_kamal = {
					has_dynasty_modifier = dynasty_castamiri_claim_failed_modifier
				}
			}
		}
	}

	effect = {
		custom_tooltip = press_castamiri_claim_tooltip
		
		save_scope_as = claimant
		character:lineofanarion53 = { save_scope_as = castamir }
		character:lineofanarion27 = { save_scope_as = eldacar }
		
		if = {
			limit = { # Minor News
				has_game_rule = all_news
			}
			every_player = { #Global News Announcement
				trigger_event = news_event.0012
			}
		}

		trigger_event = {
			id = umbar.1000
		}
	}
}

decision_turn_to_piracy = {	#Become a full-time Corsair (Player Var)
	ai_check_interval = 60
	picture = "gfx/interface/illustrations/decisions/decision_set_sail.dds"
	sort_order = 70
	desc = decision_turn_to_piracy.desc
	selection_tooltip = decision_turn_to_piracy.tt
	confirm_text = decision_turn_to_piracy_confirm

	is_shown = {
		#NOR = {
		#	faith.religion = { is_in_family = rf_eruhini }
		#	faith.religion = { is_in_family = rf_forcesofevil }
		#}
		OR = {
			faith.religion = religion:adunai_religion
			faith.religion = religion:harad_religion
			faith.religion = religion:far_harad_religion
		}
		NOT = { faith = faith:faith_corsair }
		NOT = { has_character_flag = became_corsair }
		is_elf = no
		cannot_be_killed = no
		primary_title = {
			NOR = {
				is_mercenary_company = yes
				is_holy_order = yes
				is_head_of_faith = yes
			}
		}
		any_realm_province = {
			is_coastal = yes
		}
		capital_county.title_province ?= {
			geographical_region = custom_greater_corsair_coast
		}
		#Must have some sort of connection to piracy
		#OR = {
		#	religion = religion:adunai_religion
		#	has_trait = viking
		#	has_trait = reaver
		#	has_cultural_tradition = tradition_seafaring
		#	has_cultural_tradition = tradition_fishermen
		#	has_cultural_tradition = tradition_corsairs_of_umbar
		#	has_cultural_tradition = tradition_practiced_pirates
		#	has_cultural_tradition = tradition_fp1_coastal_warriors
		#}
		is_ai = no
	}

	is_valid = {
		is_adult = yes
		prestige_level >= 2
		OR = {
			#has_trait = lifestyle_mariner
			has_trait = mariner_1
			has_trait = mariner_2
			has_trait = mariner_3
			has_trait = viking
			has_trait = reaver
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		#is_at_war = no
	}

	cost = {
		piety = major_piety_value
		prestige = medium_prestige_value
	}

	#cooldown = { years = 20 }

	effect = {
		add_character_flag = became_corsair
		trigger_event = umbar.1600
		set_character_faith_with_conversion = faith:faith_corsair
	}

	ai_potential = {
		always = no
	}

	ai_will_do = {
		base = 0
	}
}

decision_turn_to_piracy_AI = {	#Become a full-time Corsair (AI Var)
	ai_check_interval = 60
	picture = "gfx/interface/illustrations/decisions/decision_set_sail.dds"
	sort_order = 70
	desc = decision_turn_to_piracy.desc
	selection_tooltip = decision_turn_to_piracy.tt
	confirm_text = decision_turn_to_piracy_confirm

	is_shown = {
		#NOR = {
		#	faith.religion = { is_in_family = rf_eruhini }
		#	faith.religion = { is_in_family = rf_forcesofevil }
		#}
		OR = {
			faith.religion = religion:adunai_religion
			faith.religion = religion:harad_religion
			faith.religion = religion:far_harad_religion
		}
		NOT = { faith = faith:faith_corsair }
		NOT = { has_character_flag = became_corsair }
		is_elf = no
		cannot_be_killed = no
		primary_title = {
			NOR = {
				is_mercenary_company = yes
				is_holy_order = yes
				is_head_of_faith = yes
			}
		}
		any_realm_province = {
			is_coastal = yes
		}
		capital_county.title_province ?= {
			geographical_region = custom_greater_corsair_coast
		}
		#Must have some sort of connection to piracy
		#OR = {
		#	religion = religion:adunai_religion
		#	has_trait = viking
		#	has_trait = reaver
		#	has_cultural_tradition = tradition_seafaring
		#	has_cultural_tradition = tradition_fishermen
		#	has_cultural_tradition = tradition_corsairs_of_umbar
		#	has_cultural_tradition = tradition_practiced_pirates
		#	has_cultural_tradition = tradition_fp1_coastal_warriors
		#}

		is_ai = yes #AI variant of the decision
	}

	is_valid = {
		is_adult = yes
		NOT = { has_trait = zealous }
		NOT = {highest_held_title_tier = tier_empire}
		NOT = { this = faith.religious_head }
		OR = {
			# King's Men will consider it anywhere within the wider corsair coast region (Harondor to Tulwang)
			faith = faith:faith_kings_men_castamir
			# Anyone else with adunaic, harad or far harad religion will only consider it directly within ramlond, umbar and mardruak
			AND = {
				NOT = { faith = faith:faith_kings_men_castamir }
				capital_county.title_province = { geographical_region = custom_close_corsair_coast }
			}
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		#is_at_war = no
	}

	cost = {
		piety = medium_piety_value
	}

	#cooldown = { years = 20 }

	effect = {
		add_character_flag = became_corsair
		trigger_event = umbar.1600
		set_character_faith_with_conversion = faith:faith_corsair
		add_prestige = medium_prestige_value
		debug_log = "Corsair: AI Ruler turned to Piracy"
	}

	ai_potential = {
		#NOT = { has_trait = zealous }
		#NOT = {highest_held_title_tier = tier_empire}
		#NOT = { this = faith.religious_head }
		##is_gondor = no
		#OR = {
		#	# King's Men will consider it anywhere within the wider corsair coast region (Harondor to Tulwang)
		#	faith = faith:faith_kings_men_castamir
		#	# Anyone else with adunaic, harad or far harad religion will only consider it directly within ramlond, umbar and mardruak
		#	AND = {
		#		NOT = { faith = faith:faith_kings_men_castamir }
		#		geographical_region = custom_close_corsair_coast
		#	}
		#}
	}

	ai_will_do = {
		base = 0
		# Personality and Traits
		modifier = {
			add = 10
			has_trait = ambitious
		}
		modifier = {
			add = -15
			has_trait = content
		}
		modifier = {
			add = -5
			has_trait = generous
		}
		modifier = {
			add = 15
			has_trait = cynical
		}
		modifier = {
			add = -20
			has_trait = arrogant
			faith.religion = religion:adunai_religion
		}
		modifier = {
			add = -30
			has_trait = loyal
			is_independent_ruler = no
		}
		modifier = {
			add = 15
			has_trait = disloyal
			is_independent_ruler = no
		}
		modifier = {
			add = 25
			has_trait = viking
		}
		modifier = {
			add = 5
			has_trait = reaver
		}
		modifier = {
			add = 5
			#has_trait = lifestyle_mariner
			has_trait = mariner_1
			has_trait = mariner_2
			has_trait = mariner_3
		}
		modifier = {
			add = 30
			has_trait = adventurer
			is_independent_ruler = yes
		}
		modifier = {
			add = 10
			has_trait = adventurer
			is_independent_ruler = no
		}
		# Being independent makes it more likely
		modifier = {
			add = 40
			is_independent_ruler = yes
		}
		# Having a tolerant liege helps too
		modifier = {
			add = 10
			is_independent_ruler = no
			liege.faith = { has_doctrine = doctrine_pluralism_pluralistic }
		}
		# Same faith as liege makes it less likely
		modifier = {
			add = -10
			faith = top_liege.faith
		}
		# If my liege is a strong religious authority its unlikely to happen
		modifier = {
			add = -25
			faith = top_liege.faith
			top_liege = { this = faith.religious_head }
		}
		# If there exists a strong religious authority its less likely to happen
		modifier = {
			add = -15
			faith = { has_doctrine = doctrine_temporal_head }
			exists = faith.religious_head
		}
		# If Castamiri claim has recently failed, King's Men are much more likely
		modifier = {
			add = 35
			faith = faith:faith_kings_men_castamir
			dynasty:dynasty_kamal = {
				has_dynasty_modifier = dynasty_castamiri_claim_failed_modifier
			}
			NOT = { has_character_modifier = castamiri_claim_failed }
		}
		# Haradric Vassals of a Faithful Realm (Bellakar, Good Gondor, NiE) are unlikely
		modifier = {
			add = -50
			OR = {
				faith.religion = religion:harad_religion
				faith.religion = religion:far_harad_religion
			}
			top_liege = { 
				faith.religion = { is_in_family = rf_eruhini }
				highest_held_title_tier = tier_empire
			 }
		}
		# Being Coastal is Important
		modifier = {
			add = -50
			capital_county = {
				is_coastal_county = no
			}
		}
		# Being located at a historically important capital as kings men makes you unlikely
		modifier = {
			add = -50
			religion = religion:adunai_religion
			capital_county = {
				OR = {
					this = title:c_umbar
					this = title:c_ramlond
					this = title:c_mirlond
				}
			}
		}
		# Having a corsair capital will make it more likely
		modifier = {
			add = 25
			capital_county.faith = faith:faith_corsair
		}
		# Cultural Traditions may help
		modifier = {
			add = 5
			culture = {
				OR = {
					has_cultural_tradition = tradition_seafaring
					has_cultural_tradition = tradition_fishermen
				}
			}
		}
		modifier = {
			add = 25
			culture = {
				OR = {
					has_cultural_tradition = tradition_corsairs_of_umbar
					has_cultural_tradition = tradition_practiced_pirates
					has_cultural_tradition = tradition_fp1_coastal_warriors
				}
			}
			is_independent_ruler = no
		}
		modifier = {
			add = 55
			culture = {
				OR = {
					has_cultural_tradition = tradition_corsairs_of_umbar
					has_cultural_tradition = tradition_practiced_pirates
					has_cultural_tradition = tradition_fp1_coastal_warriors
				}
			}
			is_independent_ruler = yes
		}
		modifier = {
			add = -30
			culture = {
				NOR = {
					has_cultural_tradition = tradition_seafaring
					has_cultural_tradition = tradition_fishermen
					has_cultural_tradition = tradition_corsairs_of_umbar
					has_cultural_tradition = tradition_practiced_pirates
					has_cultural_tradition = tradition_fp1_coastal_warriors
				}
			}
		}
		modifier = {
			add = 20
			culture = culture:mardrukan
		}
		# Kings are less likely to convert
		modifier = {
			add = -50
			highest_held_title_tier = tier_kingdom
		}
		# Castamiri are less likely to stray from King's Men
		modifier = {
			add = -15
			dynasty = dynasty:dynasty_kamal
		}
	}
}

#
#decision_wildmen_invasion_gondor = {
#	title = decision_wildman_invasion_t
#	picture = "gfx/interface/illustrations/decisions/fp1_decision_forge_jomsvikings.dds"
#	major = yes
#	ai_goal = yes
#	ai_potential = { always = yes }
#	ai_will_do = { base = 100 }
#	selection_tooltip = decision_wildman_invasion_tooltip
#	desc = decision_wildman_invasion_desc
#	confirm_text = decision_wildman_invasion_confirm
#	is_shown = {
#		is_ruler = yes
#		is_landed = yes
#		dynasty = dynasty:dynasty_castamir
#		has_title = title:k_umbar
#		has_character_modifier = black_lord_of_umbar_modifier
#		NOT = {
#				is_target_in_global_variable_list = {
#				name = unavailable_unique_decisions
#				target = flag:decision_wildmen_invasion_gondor
#				}
#		}
#		
#	}
#	is_valid_showing_failures_only = {
#		title:d_nan_i_feryn.holder = {
#			is_at_war = no
#		}
#	}
#	is_valid = {
#		is_independent_ruler = yes
#		has_title = title:k_umbar
#		dynasty = dynasty:dynasty_castamir
#
#	}
#	cost = {
#		gold = 350
#	}
#	effect = {
#		custom_tooltip = decision_wildman_invasion_tooltip
#		custom_tooltip = decision_wildman_invasion_tooltip_2
#		title:k_umbar.holder = { save_scope_as = black_lord }
#		hidden_effect = {
#			#We prefer to use actual characters, but if there aren't any, we try to generate a fallback.
#			##Populate Western list backup.
#			if = {
#				limit = {
#					NOT = {
#						any_in_global_list = {
#							variable = western_scandinavian_adventurer_list
#							count >= 1
#							valid_scandinavian_adventurer = yes
#						}
#					}
#					any_county_in_region = {
#						region = dlc_fp1_region_lotr_western_pool
#						lotr_wildpeople_trigger = yes
#					}
#				}
#				random_county_in_region = {
#					region = dlc_fp1_region_lotr_western_pool
#					limit = { lotr_wildpeople_trigger = yes }
#					save_scope_as = scandinavian_county
#				}
#				create_character = {
#					location = scope:scandinavian_county.title_province
#					template = fp1_western_warrior_character
#					save_scope_as = backup_adventurer
#				}
#				scope:backup_adventurer = {
#					add_to_global_variable_list = {
#						name = western_scandinavian_adventurer_list
#						target = this
#					}
#					add_character_modifier = agent_of_corsairs
#				}
#				add_courtier = scope:backup_adventurer # Matt note: This lets the player keep tabs on them.
#			}
#		}
#		trigger_event = {
#			id = fp1_scandinavian_adventurers.0002
#			days = { 1 10 }
#		}
#		add_to_global_variable_list = {
#			name = unavailable_unique_decisions
#			target = flag:decision_wildmen_invasion_gondor
#		}
#	}
#}
