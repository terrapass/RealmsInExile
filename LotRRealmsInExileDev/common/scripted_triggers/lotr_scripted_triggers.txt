
### CULTURAL GROUPS ###

faith_is_good = {
	OR = {
		religion = { is_in_family = rf_eruhini }
		faith = { has_doctrine = doctrine_echoes_of_the_ainur }
	}
}

faith_is_evil = {
	OR = {
		religion = { is_in_family = rf_forcesofevil }
		faith = { has_doctrine = doctrine_dominion_of_the_dark }
	}
}

faith_is_neutral = {
	faith_is_good = no
	faith_is_evil = no
}

lotr_is_immortal_culture_trigger = {
	OR = {
		is_valar = yes
		is_maiar = yes
		is_undead = yes
		is_elf = yes
		is_wastelands = yes
	}
}

#lotr_cannot_get_disease_trigger = {
#	OR = {
#		culture = { has_cultural_pillar = heritage_ainur }
#		culture = { has_cultural_pillar = all elven heritages }
#	}
#}

#lotr_disease_resistant_trigger = {
#	OR = {
#		culture_group = culture_group: dwarves, numenoreans, ect
#	}
#}

#lotr_cannot_die_trigger = {
#	OR = {
#		culture = { has_cultural_pillar = heritage_ainur }
#		add traits/flags if character is immortal like Elrond
#		add artifact holders like Frodo
#	}
#}

lotr_numenor_culture_trigger = {
	culture = {
		OR = {
			has_cultural_pillar = heritage_dunedain
			has_cultural_pillar = heritage_bellakari
			has_cultural_pillar = heritage_northern_adunaic
			has_cultural_pillar = heritage_southern_adunaic
		}
	}
}

lotr_gwathuirim_heritage_trigger = {
	culture = {
		OR = {
			has_cultural_pillar = heritage_daen
			has_cultural_pillar = heritage_dunlending
		}
	}
}
lotr_northron_group_culture_trigger = {
	culture = {
		OR = {
			has_cultural_pillar = heritage_hadorim
			has_cultural_pillar = heritage_northron
		}
	}
}
lotr_horse_lords_trigger = {
	OR = {
		culture = {
			has_cultural_pillar = heritage_hadorim
		}
		culture = culture:hill_dunlending
#		culture = variags, balchoth, wainriders, ect
#		faith = any faiths with a focus on Béma (the Valar Oromë) and his horse Nahar.
	}
}
lotr_haradrim_group_culture_trigger = {
	OR = {
		culture = culture:umbarean
		culture = culture:mardrukan
		culture = { has_cultural_pillar = heritage_northern_apysaic }
		culture = { has_cultural_pillar = heritage_middle_apysaic }
		culture = { has_cultural_pillar = heritage_southern_apysaic }
		culture = { has_cultural_pillar = heritage_tulwangi }
		culture = { has_cultural_pillar = heritage_nafarati }
		# Matt note: should include Bellanarud and Tantûraki cultures.
		# Check the code after Royal Court.
	}
}
lotr_last_alliance_cultures_trigger = {
	# Cultures that were part of the Last Alliance.
	# A Free Peoples holy war/liberation war fought by the
	# combined strength of these groups.
	OR = {
		culture = { has_cultural_pillar = heritage_dunedain }
		culture = { has_cultural_pillar = heritage_hadorim }
		culture = { has_cultural_pillar = heritage_calaquendi }
		culture = { has_cultural_pillar = heritage_lomiquendi }
		culture = { has_cultural_pillar = heritage_bellakari }
#		Dwarven houses who joined the Last Alliance.
	}
}

lotr_elven_cultures_trigger = {
	OR = {
		culture = { has_cultural_pillar = heritage_quendi }
		culture = { has_cultural_pillar = heritage_moriquendi }
		culture = { has_cultural_pillar = heritage_calaquendi }
		culture = { has_cultural_pillar = heritage_lomiquendi }
	}
}

lotr_beorning_trigger = {
	has_trait = skinchanger
	OR = {
		culture = culture:valemen
		culture = culture:woodmen		
	}
}

lotr_urbanised_northron_cultures_trigger = {
	AND = {
		culture = { has_cultural_pillar = heritage_northron }
		OR = {
			culture = culture:dalemen
			culture = culture:dorwinionrim
			culture = {any_parent_culture_or_above = dalemen}
			culture = {any_parent_culture_or_above = dorwinionrim}
		}
	}
}

### Elven Cultural Triggers ###

noldor_trigger = { # Handles access to Noldor units
	OR = {
		AND = {
			culture = { has_cultural_pillar = heritage_calaquendi }
			OR = {
				culture = culture:noldor
				culture = {any_parent_culture_or_above = noldor}
			}
		}
		#has_title = title:e_lindon # For Cirdan-led Lindon to have access to Noldor events and units
	}
}
sindar_trigger = { # Handles access to Sindar units
	AND = {
		culture = { has_cultural_pillar = heritage_lomiquendi }
		OR = {
			culture = culture:sindar
			culture = {any_parent_culture_or_above = sindar}
		}
	}
}
galadhrim_trigger = { # Handles access to Galadhrim units
	AND = {
		culture = { has_cultural_pillar = heritage_lomiquendi }
		OR = {
			culture = culture:nandor
			culture = culture:galadhrim
			culture = {any_parent_culture_or_above = culture:nandor}
			culture = {any_parent_culture_or_above = culture:galadhrim}
		}
	}
}
greenwood_trigger = { # Handles access to Greenwood units
	AND = {
		culture = { has_cultural_pillar = heritage_lomiquendi }
		OR = {
			culture = culture:silvan
			culture = culture:lasgalendrim
			culture = {any_parent_culture_or_above = culture:silvan}
		}
	}
}

# Vanyar Triggers - low priority, only Vanyar are in Valinor

# Teleri Triggers - low priority, Valinorean Teleri

# Avari Triggers - low priority, no Avari at present

### WARBAND TRIGGERS ###
lotr_allows_warbands_trigger = {
	AND = {
		OR = {
			this.culture = { has_cultural_pillar = heritage_hadorim }
			this.culture = { has_cultural_pillar = heritage_daen }
			this.culture = { has_cultural_pillar = heritage_dunlending }
		}
		NOT = {
			this.culture = culture:rohirrim
			this.culture = { has_cultural_pillar = heritage_ainur }
			has_character_flag = is_saruman
		}
		is_wastelands = no
	}
}
lotr_warbands_mirkwood_leofring_trigger = {
	AND = {
		this.culture = culture:leofring
		completely_controls = title:c_dorfirnen
		is_wastelands = no
	}
}
lotr_warbands_parth_celebrant_leofring_trigger = {
	AND = {
		this.culture = culture:leofring
		is_wastelands = no
		OR = {
			completely_controls = title:c_parthcelebrant
			completely_controls = title:c_thorlorien
		}
	}
}
lotr_warbands_bandit_leofring_trigger = {
	AND = {
		this.culture = culture:leofring
		is_wastelands = no
		OR = {
			completely_controls = title:c_varad
			completely_controls = title:c_nanlothanduin
			completely_controls = title:c_southundeep
			completely_controls = title:c_berennyn
			completely_controls = title:c_mernael
			completely_controls = title:c_audaghaim
			completely_controls = title:c_gorotham
			completely_controls = title:c_gladden_fields
			completely_controls = title:c_norwold
			completely_controls = title:c_northundeep
			completely_controls = title:c_sutwold
			completely_controls = title:c_fortalf
			completely_controls = title:c_theeasternwall
			completely_controls = title:c_hartalf
		}
	}
}
lotr_warbands_dwarrowhall_leofring_trigger = {
	AND = {
		this.culture = culture:leofring
		is_wastelands = no
		OR = {
			completely_controls = title:c_byretor
			completely_controls = title:c_eorcnan
		}
	}
}
#lotr_warbands_leofring_trigger = {
#	AND = {
#		this.culture = culture:leofring
#	}
#}
lotr_warbands_eotheod_trigger = {
	AND = {
		this.culture = culture:eotheod
		is_wastelands = no
	}
}
lotr_warbands_hill_dunlending_trigger = {
	AND = {
		is_wastelands = no
		OR = {
			this.culture = culture:hill_dunlending
			this.culture = culture:isengard_dunlending
		}
		OR = {
			completely_controls = title:c_frecalund
			completely_controls = title:c_larcnoc
			completely_controls = title:c_earcnoc
			completely_controls = title:c_tormdreng
			completely_controls = title:c_nandunstrem
			completely_controls = title:c_chailcaerdh
			completely_controls = title:c_dunfearnshaws
			completely_controls = title:c_tormcaladach
		}
	}
}
lotr_warbands_fisherfolk_trigger = {
	AND = {
		is_wastelands = no
		this.culture = {
			OR = {
				has_cultural_pillar = heritage_daen
				has_cultural_pillar = heritage_dunlending
			}
		}
		OR = {
			completely_controls = title:c_iren
			completely_controls = title:c_carreglyn
			completely_controls = title:c_angren
			completely_controls = title:c_cadlus
		}
		NOT = {
			this.culture = culture:isengard_dunlending
		}
	}
}
lotr_warbands_dunlending_trigger = {
	AND = {
		is_wastelands = no
		this.culture = {
			OR = {
				has_cultural_pillar = heritage_daen
				has_cultural_pillar = heritage_dunlending
			}
		}
		OR = {
			completely_controls = title:c_westmarches
			completely_controls = title:c_valesoftheadorn
			completely_controls = title:c_emyndunendor
			completely_controls = title:c_gaetir
			completely_controls = title:c_galtrev
			completely_controls = title:c_starkmoors
			completely_controls = title:c_morbet
			completely_controls = title:c_nandunstrem
		}
		NOT = {
			this.culture = culture:isengard_dunlending
		}
	}
}
lotr_warbands_gwathlo_estuary_trigger = {
	AND = {
		is_wastelands = no
		this.culture = culture:saralain
	}
}
lotr_warbands_gwathlo_trigger = {
	AND = {
		is_wastelands = no
		OR = {
			this.culture = culture:gwathlo_gwathuirim
			this.culture = culture:enedhwaith_gwathuirim
		}
	}
}
lotr_warbands_gondor_gwathuirim_trigger = {
	AND = {
		is_wastelands = no
		this.culture = { has_cultural_pillar = heritage_daen }
	}
}
lotr_warbands_haradrim_suladan_trigger = {
	AND = {
		is_wastelands = no
		this.culture = { has_cultural_pillar = heritage_northern_apysaic }
		OR = {
			completely_controls = title:k_haruzan
		}
	}
}
lotr_warbands_haradrim_corsair_trigger = {
	AND = {
		is_wastelands = no
		this.culture = { has_cultural_pillar = heritage_northern_apysaic }
		OR = {
			completely_controls = title:shafra
			completely_controls = title:suk_oda
			completely_controls = title:korb_ugarta
		}
	}
}
lotr_warbands_haradrim_desert_trigger = {
	AND = {
		is_wastelands = no
		this.culture = { has_cultural_pillar = heritage_northern_apysaic }
		OR = {
			completely_controls = title:c_khabazh
			completely_controls = title:c_tajama
			completely_controls = title:c_zakakha
			completely_controls = title:c_ardrista
			completely_controls = title:c_rakha
			completely_controls = title:c_kharga
			completely_controls = title:c_arakh
			completely_controls = title:c_kajbah
			completely_controls = title:c_pazaran
		}
	}
}
lotr_warbands_haradrim_trigger = {
	AND = {
		is_wastelands = no
		this.culture = { has_cultural_pillar = heritage_northern_apysaic }
	}
}



not_in_use_trigger = {
	OR = {
		culture = { has_cultural_pillar = heritage_daen }
		culture = { has_cultural_pillar = heritage_hadorim }
	}
	NOT = {
		culture = culture:rohirrim
		culture = { has_cultural_pillar = heritage_ainur }
		has_character_flag = is_saruman
	}
}

lotr_isengard_urukhai_culture_trigger = {
	culture = culture:isengard_urukhai
}

lotr_armies_are_outnumbered = {
	total_enemy_strength > total_ally_strength
}

lotr_at_peace_with_gondor = {
	NOR = { 
		any_war_enemy = {
			has_title = title:e_gondor
		}
		any_war_enemy = {
			has_title = title:e_gondor_steward
		}
	}
}

lotr_at_peace_with_rohan = {
	NOT = {
		any_war_enemy = {
			has_title = title:k_rohan
		}
	}
}



### MISSION TRIGGERS ###
# Abrakhân
character_is_valid_for_abrakhan_subjugation_mission_trigger = {
	custom_description = {
		text = "character_is_valid_for_abrakhan_subjugation_mission_trigger"
		# Is either GK or someone has taken their place as Sauron's
		# "friendly reminder" for the Haradwaith.
		OR = {
			religion = { is_in_family = rf_forcesofevil }
			faith = faith:faith_kanra
		}
		highest_held_title_tier >= tier_kingdom
		capital_province = { geographical_region = middleearth_haradwaith_far_abrakhan }
		# ToDo: is a tributary to Sauron - or however GK starts the game.
	}
}
character_is_valid_for_nafarati_subjugation_trigger = {
	is_available_adult = yes
	culture = culture:nafarati
	martial >= high_skill_rating
	# ToDo: is relevant to Nafarati and has relevant traits.
#	AND = {
#		OR = {
#			culture_group = culture_group:lotr_nafarati_group
#			culture_group = culture_group:lotr_mumakanim_group
#			faith = faith:faith_nafar
#			culture = culture:half troll culture
#		}
#		OR = {
#			has_trait = nafarati_berserker
#			has_trait = terror_of_nafarat
#		}
#	}
}
character_is_valid_for_ray_subjugation_trigger = {
	is_available_adult = yes
	# ToDo: is relevant to Ray and has relevant traits.
	stewardship >= high_skill_rating
	AND = {
		OR = {
			culture = { has_cultural_pillar = heritage_southern_apysaic }
			faith = faith:faith_ray
		}
		OR = {
			has_trait = education_stewardship_3
			has_trait = education_stewardship_4
			has_trait = administrator
			has_trait = avaricious
			short_term_gold >= major_gold_value # Matt note: this should check if they have a large amount of income.
		}
	}
}
character_is_valid_for_umbar_subjugation_trigger = {
	is_available_adult = yes
	stewardship >= high_skill_rating
	# ToDo: is relevant to Umbar and has relevant traits.
#	AND = {
#		OR = {
#			lotr_numenor_culture_trigger = yes
#			faith = faith:kings_men
#			faith = faith:faith_corsair
#			faith = faith:melkorite
#		}
#		OR = {
#			dynasty = { has_dynasty_perk = lotr_black_numenorean_legacy_1 }
#			has_trait = adventurer
#			has_trait = varangian
#		}
#	}
}

# Numenoreans and their successor states
is_gondor = {
	culture = { has_cultural_pillar = heritage_dunedain }
	OR = {
		has_primary_title = title:e_gondor_steward
		has_primary_title = title:e_gondor
		has_primary_title = title:e_castamir
#		has_title = title:e_reunited_kingdom
	}
}

is_steward_of_gondor = {
	culture = { has_cultural_pillar = heritage_dunedain }
	OR = {
		has_primary_title = title:e_gondor_steward
		has_primary_title = title:k_gondor_steward
	}
}

#is_arnor = {
#	culture = { has_cultural_pillar = heritage_dunedain }
#	OR = {
#		has_primary_title = title:e_arnor
#		has_primary_title = title:d_northern_dunedain
#		has_title = title:e_reunited_kingdom
#	}
#}

lotr_has_numenorean_culture_trigger = {
	culture = { 
		OR = {
			has_cultural_pillar = heritage_dunedain
			has_cultural_pillar = heritage_bellakari
			has_cultural_pillar = heritage_northern_adunaic
			has_cultural_pillar = heritage_southern_adunaic
		}
	}
}

lotr_numenor_in_exile_decision_show_trigger = {
	OR = {
		AND = {
			completely_controls_region = custom_anbalkumagan
			completely_controls_region = custom_gondorian_heartlands
			completely_controls_region = middleearth_haradwaith_umbar
		}
		AND = {
			completely_controls_region = custom_anbalkumagan
			completely_controls_region = custom_gondorian_heartlands
			completely_controls_region = custom_bellakar
		}
		AND = {
			completely_controls_region = custom_anbalkumagan
			completely_controls_region = middleearth_haradwaith_umbar
			completely_controls_region = custom_bellakar
		}
		AND = {
			completely_controls_region = custom_gondorian_heartlands
			completely_controls_region = middleearth_haradwaith_umbar
			completely_controls_region = custom_bellakar
		}
	}
}


### Set Sail Activity Triggers ###

coastal_province_in_realm = {
	any_realm_county = {
		title_province = { is_coastal = yes }
	}
}


owns_a_damaged_boat = {
	OR = {
		has_character_modifier = small_damaged_boat_modifier
		has_character_modifier = medium_damaged_boat_modifier
		has_character_modifier = large_damaged_boat_modifier
	}
}

owns_an_undamaged_boat = {
	OR = {
		has_character_modifier = small_boat_modifier
		has_character_modifier = medium_boat_modifier
		has_character_modifier = large_boat_modifier
	}
}

owns_a_boat = {
	OR = {
		owns_an_undamaged_boat = yes
		owns_a_damaged_boat = yes
	}
}

is_boat_purchased = {
	NOT = {
		has_character_flag =  hired_a_boat
	}
}

can_afford_a_boat = {
	owns_a_boat = no
	gold >= small_boat_hire_cost
}

### War CB ###
can_conduct_slave_expedition = {
	NOT = {
		has_character_flag = successful_slaver_expedition
	}
}

######################
#### IS A WILDERNESS?
#### Check by culture
######################


lotr_wastelands_culture_trigger_0 = {
	exists = scope:culture
	OR = {	
		scope:culture = culture:wastelands
		# Just in case something was messed up, another check
		scope:culture = { 
			has_coa_gfx = wastelands_coa_gfx 
		}		
	}	
}

lotr_wastelands_culture_trigger_1 = {
	exists = culture
	OR = {	
		culture = culture:wastelands
		# Just in case something was messed up, another check
		culture = { 
			has_coa_gfx = wastelands_coa_gfx 
		}		
	}	
}

lotr_wastelands_has_culture_trigger0 = {
	exists = scope:character
	scope:character = {
		has_culture = culture:wastelands
	}
}

lotr_wastelands_has_culture_trigger1 = {
	exists = scope:character
	scope:character.culture = culture:wastelands
}

lotr_wastelands_has_culture_trigger2 = {
	exists = scope:culture
	scope:culture = culture:wastelands
}

lotr_wastelands_has_culture_trigger3 = {
	exists = scope:landed_title
	OR = {
		exists = scope:landed_title.barony
		exists = scope:landed_title.county
	}
	scope:landed_title.culture = culture:wastelands	
}

lotr_wastelands_has_culture_trigger4 = {
	exists = scope:province
	scope:province.culture = culture:wastelands
}


is_wastelands = {
	OR = {
		lotr_wastelands_culture_trigger_0 = yes	
		lotr_wastelands_culture_trigger_1 = yes	
		lotr_wastelands_has_culture_trigger0 = yes
		lotr_wastelands_has_culture_trigger1 = yes
		lotr_wastelands_has_culture_trigger2 = yes
		lotr_wastelands_has_culture_trigger3 = yes
		lotr_wastelands_has_culture_trigger4 = yes
	}
}

county_is_elven = {
	county = {
		OR = {
			culture = { has_cultural_pillar = heritage_quendi }
			culture = { has_cultural_pillar = heritage_calaquendi }
			culture = { has_cultural_pillar = heritage_lomiquendi }
			culture = { has_cultural_pillar = heritage_moriquendi }
		}
	}
}

no_existing_elven_stronghold_in_duchy = {
	any_province = {
		count = 0
		NOT = { this = root }
		duchy = root.duchy
		OR = {
			has_building = elven_settlement_03
			has_building = elven_settlement_04
			has_building = elven_settlement_05
		}
	}	
}

no_existing_elven_city_in_kingdom = {
	any_province = {
		count = 0
		NOT = { this = root }
		kingdom = root.kingdom
		OR = {
			has_building = elven_settlement_06
			has_building = elven_settlement_07
		}
	}
}

##########################
## NEW SORCERY TRIGGERS ##
##########################


can_learn_sorcery = {
	AND = {
		piety_level >= 1
		NOT = {
			has_character_flag = learning_sorcery
			has_character_modifier = studying_dark_arts_modifier
			has_character_modifier = sorcery_connoisseur_modifier
			has_trait = sorcerer
			has_trait = nazgul
			is_evil_istari = yes
			has_trait = maiar
		}
		AND = {
			OR = {
				has_trait = intellect_good_3
				has_trait = zealous
				has_trait = mystic_3
				has_trait = witch
				has_trait = education_intrigue_4
				has_trait = education_learning_4
			}
			religion = { is_in_family = rf_forcesofevil }
		}
	
		learning >= 5
		#	learning >= 16
	}
	
}

can_learn_sorcery_ai = {
	is_ai = yes
	religion = { is_in_family = rf_forcesofevil }
	NOT = {
		has_character_flag = learning_sorcery
		has_character_modifier = studying_dark_arts_modifier
		has_character_modifier = sorcery_connoisseur_modifier
		has_trait = sorcerer
		has_trait = nazgul
		is_evil_istari = yes
		has_trait = maiar
	}
	AND = {
		calc_true_if = {
    		amount >= 2
			piety_level >= 3
			has_trait = intellect_good_3
			has_trait = zealous
			has_trait = schemer
			has_trait = theologian
			has_trait = mystic_3
			has_trait = witch
			has_trait = education_intrigue_4
			has_trait = education_learning_4
			learning >= 16
		}
	}	
}